I"‰<ul id="markdown-toc">
  <li><a href="#ä»‹ç»" id="markdown-toc-ä»‹ç»">ä»‹ç»</a></li>
  <li><a href="#ç”¨æ³•" id="markdown-toc-ç”¨æ³•">ç”¨æ³•</a></li>
</ul>
<hr />

<h1 id="ä»‹ç»">ä»‹ç»</h1>

<p><code class="language-plaintext highlighter-rouge"> Transactions</code>æ˜¯<code class="language-plaintext highlighter-rouge">CoreAnimation</code>çš„ç”¨äºå°†å¤šä¸ª<code class="language-plaintext highlighter-rouge">layer tree</code>æ“ä½œæ‰¹é‡åŒ–ä¸ºæ¸²æŸ“æ ‘çš„åŸå­æ›´æ–°çš„æœºåˆ¶ã€‚ å¯¹<code class="language-plaintext highlighter-rouge">layer tree</code>çš„æ¯ä¸ªä¿®æ”¹éƒ½éœ€è¦äº‹åŠ¡ä½œä¸ºå…¶ä¸€éƒ¨åˆ†ã€‚
` CoreAnimation<code class="language-plaintext highlighter-rouge">æ”¯æŒä¸¤ç§äº‹åŠ¡ï¼Œâ€œæ˜¾å¼â€äº‹åŠ¡å’Œéšå¼äº‹åŠ¡ã€‚
 **æ˜¾å¼äº‹åŠ¡**æ˜¯ç¨‹åºå‘˜åœ¨ä¿®æ”¹å±‚æ ‘ä¹‹å‰è°ƒç”¨</code>[CATransaction begin]<code class="language-plaintext highlighter-rouge">ï¼Œç„¶åæ˜¯</code>[CATransaction commit]<code class="language-plaintext highlighter-rouge">ã€‚
 å½“å±‚æ ‘ç”±æ²¡æœ‰æ´»åŠ¨äº‹åŠ¡çš„çº¿ç¨‹ä¿®æ”¹æ—¶ï¼Œ</code>CoreAnimation`è‡ªåŠ¨åˆ›å»º<strong>éšå¼äº‹åŠ¡</strong>ã€‚
 å®ƒä»¬åœ¨çº¿ç¨‹çš„è¿è¡Œå¾ªç¯ä¸‹ä¸€æ¬¡è¿­ä»£æ—¶è‡ªåŠ¨æäº¤ã€‚ åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ˆå³ï¼Œæ²¡æœ‰è¿è¡Œå¾ªç¯ï¼Œæˆ–è€…è¿è¡Œå¾ªç¯è¢«é˜»å¡ï¼‰ï¼Œå¯èƒ½æœ‰å¿…è¦ä½¿ç”¨æ˜¾å¼äº‹åŠ¡æ¥åŠæ—¶åœ°å‘ˆç°æ ‘æ›´æ–°ã€‚</p>

<pre><code class="language-objective-c">/* CoreAnimation - CATransaction.h

   Copyright (c) 2006-2016, Apple Inc.
   All rights reserved. */

#import &lt;QuartzCore/CABase.h&gt;
#import &lt;Foundation/NSObject.h&gt;

/* Transactions are CoreAnimation's mechanism for batching multiple layer-
 * tree operations into atomic updates to the render tree. Every
 * modification to the layer tree requires a transaction to be part of.
 *
 * CoreAnimation supports two kinds of transactions, "explicit" transactions
 * and "implicit" transactions.
 *
 * Explicit transactions are where the programmer calls `[CATransaction
 * begin]' before modifying the layer tree, and `[CATransaction commit]'
 * afterwards.
 *
 * Implicit transactions are created automatically by CoreAnimation when the
 * layer tree is modified by a thread without an active transaction.
 * They are committed automatically when the thread's run-loop next
 * iterates. In some circumstances (i.e. no run-loop, or the run-loop
 * is blocked) it may be necessary to use explicit transactions to get
 * timely render tree updates. */

@class CAMediaTimingFunction;

NS_ASSUME_NONNULL_BEGIN

CA_CLASS_AVAILABLE (10.5, 2.0, 9.0, 2.0)
@interface CATransaction : NSObject

/* Begin a new transaction for the current thread; nests. */
// åœ¨å½“å‰çº¿ç¨‹å¼€å§‹ä¸€ä¸ªäº‹åŠ¡
+ (void)begin;

/* Commit all changes made during the current transaction. Raises an
 * exception if no current transaction exists. */
// æäº¤å½“å‰äº‹åŠ¡æœŸé—´è¿›è¡Œçš„æ‰€æœ‰æ›´æ”¹ã€‚ å¦‚æœä¸å­˜åœ¨å½“å‰äº‹åŠ¡ï¼Œåˆ™å¼•å‘å¼‚å¸¸ã€‚
+ (void)commit;

/* Commits any extant implicit transaction. Will delay the actual commit
 * until any nested explicit transactions have completed. */
// æäº¤ä»»ä½•ç°å­˜çš„éšå¼äº‹åŠ¡ã€‚ å°†å»¶è¿Ÿå®é™…çš„commituntilä»»ä½•åµŒå¥—çš„æ˜¾å¼äº‹åŠ¡å·²ç»å®Œæˆã€‚
+ (void)flush;

/* Methods to lock and unlock the global lock. Layer methods automatically
 * obtain this while modifying shared state, but callers may need to lock
 * around multiple operations to ensure consistency. The lock is a
 * recursive spin-lock (i.e shouldn't be held for extended periods). */
// é”å®šå’Œè§£é”å…¨å±€é”çš„æ–¹æ³•ã€‚ Layeræ–¹æ³•è‡ªåŠ¨åœ¨ä¿®æ”¹å…±äº«çŠ¶æ€æ—¶è·å¾—è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯è°ƒç”¨è€…å¯èƒ½éœ€è¦é”å®šå¤šä¸ªæ“ä½œä»¥ç¡®ä¿ä¸€è‡´æ€§ã€‚ é”æ˜¯ä¸€ä¸ªé€’å½’è‡ªæ—‹é”ï¼ˆå³ä¸åº”é•¿æ—¶é—´ä¿æŒï¼‰ã€‚
+ (void)lock;
+ (void)unlock;

/* Accessors for the "animationDuration" per-thread transaction
 * property. Defines the default duration of animations added to
 * layers. Defaults to 1/4s. */
// â€œanimationDurationâ€æ¯ä¸ªçº¿ç¨‹äº‹åŠ¡å±æ€§çš„è®¿é—®å™¨ã€‚ å®šä¹‰æ·»åŠ åˆ°å›¾å±‚çš„åŠ¨ç”»çš„é»˜è®¤æŒç»­æ—¶é—´ã€‚ é»˜è®¤ä¸º1 / 4sã€‚
+ (CFTimeInterval)animationDuration;
+ (void)setAnimationDuration:(CFTimeInterval)dur;

/* Accessors for the "animationTimingFunction" per-thread transaction
 * property. The default value is nil, when set to a non-nil value any
 * animations added to layers will have this value set as their
 * "timingFunction" property. Added in Mac OS X 10.6. */
// â€œanimationTimingFunctionâ€æ¯çº¿ç¨‹äº‹åŠ¡å±æ€§çš„è®¿é—®å™¨ã€‚ é»˜è®¤å€¼ä¸ºnilï¼Œå½“è®¾ç½®ä¸ºénilå€¼æ—¶ï¼Œæ·»åŠ åˆ°å›¾å±‚çš„ä»»ä½•åŠ¨ç”»éƒ½å°†æ­¤å€¼è®¾ç½®ä¸ºå…¶â€œtimingFunctionâ€å±æ€§ã€‚ åœ¨Mac OS X 10.6ä¸­æ·»åŠ ã€‚
+ (nullable CAMediaTimingFunction *)animationTimingFunction;
+ (void)setAnimationTimingFunction:(nullable CAMediaTimingFunction *)function;

/* Accessors for the "disableActions" per-thread transaction property.
 * Defines whether or not the layer's -actionForKey: method is used to
 * find an action (aka. implicit animation) for each layer property
 * change. Defaults to NO, i.e. implicit animations enabled. */
// â€œdisableActionsâ€æ¯çº¿ç¨‹äº‹åŠ¡å±æ€§çš„è®¿é—®å™¨ã€‚å®šä¹‰å›¾å±‚çš„-actionForKeyï¼šæ–¹æ³•æ˜¯å¦ç”¨äºä¸ºæ¯ä¸ªå›¾å±‚å±æ€§æ›´æ”¹æ‰¾åˆ°ä¸€ä¸ªæ“ä½œï¼ˆä¹Ÿç§°ä¸ºimplicitanimationï¼‰ã€‚ é»˜è®¤ä¸ºNOï¼Œå³å¯ç”¨äº†éšå¼åŠ¨ç”»ã€‚
+ (BOOL)disableActions;
+ (void)setDisableActions:(BOOL)flag;

/* Accessors for the "completionBlock" per-thread transaction property.
 * Once set to a non-nil value the block is guaranteed to be called (on
 * the main thread) as soon as all animations subsequently added by
 * this transaction group have completed (or been removed). If no
 * animations are added before the current transaction group is
 * committed (or the completion block is set to a different value), the
 * block will be invoked immediately. Added in Mac OS X 10.6. */
// æ¯ä¸ªçº¿ç¨‹äº‹åŠ¡å±æ€§çš„â€œcompletionBlockâ€è®¿é—®å™¨ã€‚è®¾ç½®ä¸ºénilå€¼åï¼Œä¸€æ—¦æ­¤äº‹åŠ¡ç»„éšåæ·»åŠ çš„æ‰€æœ‰åŠ¨ç”»éƒ½å·²å®Œæˆï¼ˆæˆ–å·²åˆ é™¤ï¼‰ï¼Œå—å°±è¢«ä¿è¯è¢«è°ƒç”¨ï¼ˆåœ¨ä¸»çº¿ç¨‹ä¸Šï¼‰ ï¼‰ã€‚ å¦‚æœåœ¨æäº¤å½“å‰äº‹åŠ¡ç»„ä¹‹å‰æ²¡æœ‰æ·»åŠ åŠ¨ç”»ï¼ˆæˆ–è€…å®Œæˆå—è¢«è®¾ç½®ä¸ºä¸åŒçš„å€¼ï¼‰ï¼Œåˆ™å°†ç«‹å³è°ƒç”¨è¯¥å—ã€‚ åœ¨Mac OS X 10.6ä¸­æ·»åŠ ã€‚
#if __BLOCKS__
+ (nullable void (^)(void))completionBlock;
+ (void)setCompletionBlock:(nullable void (^)(void))block;
#endif

/* Associate arbitrary keyed-data with the current transaction (i.e.
 * with the current thread).
 *
 * Nested transactions have nested data scope, i.e. reading a key
 * searches for the innermost scope that has set it, setting a key
 * always sets it in the innermost scope.
 *
 * Currently supported transaction properties include:
 * "animationDuration", "animationTimingFunction", "completionBlock",
 * "disableActions". See method declarations above for descriptions of
 * each property.
 *
 * Attempting to set a property to a type other than its document type
 * has an undefined result. */
/*å°†ä»»æ„é”®æ§æ•°æ®ä¸å½“å‰äº‹åŠ¡ï¼ˆå³ä¸å½“å‰çº¿ç¨‹ï¼‰å…³è”ã€‚
åµŒå¥—äº‹åŠ¡å…·æœ‰åµŒå¥—æ•°æ®ä½œç”¨åŸŸï¼Œå³è¯»å–ä¸€ä¸ªé”®ï¼Œæœç´¢å·²è®¾ç½®å®ƒçš„æœ€å†…å±‚ä½œç”¨åŸŸï¼Œè®¾ç½®é”®æ€»æ˜¯å°†å…¶è®¾ç½®åœ¨æœ€å†…å±‚ä½œç”¨åŸŸã€‚
å½“å‰æ”¯æŒçš„äº‹åŠ¡å±æ€§åŒ…æ‹¬ï¼šâ€œanimationDurationâ€ï¼Œâ€œanimationTimingFunctionâ€ï¼Œâ€œcompletionBlockâ€ï¼Œâ€œdisableActionsâ€ã€‚ æœ‰å…³æ¯ä¸ªå±æ€§çš„æè¿°ï¼Œè¯·å‚é˜…ä¸Šé¢çš„æ–¹æ³•å£°æ˜ã€‚ å°è¯•å°†å±æ€§è®¾ç½®ä¸ºéæ–‡æ¡£ç±»å‹ä»¥å¤–çš„ç±»å‹å…·æœ‰æœªå®šä¹‰çš„ç»“æœã€‚*/
+ (nullable id)valueForKey:(NSString *)key;
+ (void)setValue:(nullable id)anObject forKey:(NSString *)key;

@end

/** Transaction property ids. **/

CA_EXTERN NSString * const kCATransactionAnimationDuration
    CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);
CA_EXTERN NSString * const kCATransactionDisableActions
    CA_AVAILABLE_STARTING (10.5, 2.0, 9.0, 2.0);
CA_EXTERN NSString * const kCATransactionAnimationTimingFunction
    CA_AVAILABLE_STARTING (10.6, 3.0, 9.0, 2.0);
CA_EXTERN NSString * const kCATransactionCompletionBlock
    CA_AVAILABLE_STARTING (10.6, 4.0, 9.0, 2.0);

NS_ASSUME_NONNULL_END

</code></pre>

<h1 id="ç”¨æ³•">ç”¨æ³•</h1>

<p>ç›®å‰ä¸å¤ªäº†è§£ï¼Œç­‰ä»¥åç ”ç©¶ä¸‹ã€‚</p>
:ET