I"æ¤<ul id="markdown-toc">
  <li><a href="#ç®€ä»‹" id="markdown-toc-ç®€ä»‹">ç®€ä»‹</a></li>
  <li><a href="#åˆ†æ" id="markdown-toc-åˆ†æ">åˆ†æ</a>    <ul>
      <li><a href="#ç»“æ„" id="markdown-toc-ç»“æ„">ç»“æ„</a></li>
      <li><a href="#æµç¨‹" id="markdown-toc-æµç¨‹">æµç¨‹</a></li>
      <li><a href="#æ³¨é‡Š" id="markdown-toc-æ³¨é‡Š">æ³¨é‡Š</a></li>
      <li><a href="#è®¿é—®æƒé™" id="markdown-toc-è®¿é—®æƒé™">è®¿é—®æƒé™</a>        <ul>
          <li><a href="#å¯¹äºfunc" id="markdown-toc-å¯¹äºfunc">å¯¹äº<code class="language-plaintext highlighter-rouge">func</code></a></li>
          <li><a href="#å¯¹äºclass" id="markdown-toc-å¯¹äºclass">å¯¹äº<code class="language-plaintext highlighter-rouge">class</code></a></li>
        </ul>
      </li>
      <li><a href="#é”™è¯¯" id="markdown-toc-é”™è¯¯">é”™è¯¯</a></li>
      <li><a href="#swiftyjsonä¸­jsonçš„ç±»å‹" id="markdown-toc-swiftyjsonä¸­jsonçš„ç±»å‹"><code class="language-plaintext highlighter-rouge">SwiftyJSON</code>ä¸­<code class="language-plaintext highlighter-rouge">JSON</code>çš„ç±»å‹</a></li>
      <li><a href="#jsonserialization" id="markdown-toc-jsonserialization"><code class="language-plaintext highlighter-rouge">JSONSerialization</code></a></li>
      <li><a href="#jsonç»“æ„ä½“" id="markdown-toc-jsonç»“æ„ä½“"><code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“</a>        <ul>
          <li><a href="#åˆå§‹åŒ–" id="markdown-toc-åˆå§‹åŒ–">åˆå§‹åŒ–</a>            <ul>
              <li><a href="#äºŒè¿›åˆ¶æ•°æ®data" id="markdown-toc-äºŒè¿›åˆ¶æ•°æ®data">äºŒè¿›åˆ¶æ•°æ®<code class="language-plaintext highlighter-rouge">Data</code></a></li>
              <li><a href="#ä»»æ„ç±»å‹any" id="markdown-toc-ä»»æ„ç±»å‹any">ä»»æ„ç±»å‹Any</a></li>
              <li><a href="#jsonå­—ç¬¦ä¸²string" id="markdown-toc-jsonå­—ç¬¦ä¸²string"><code class="language-plaintext highlighter-rouge">JSON</code>å­—ç¬¦ä¸²<code class="language-plaintext highlighter-rouge">String</code></a></li>
            </ul>
          </li>
          <li><a href="#åˆå¹¶merge" id="markdown-toc-åˆå¹¶merge">åˆå¹¶(<code class="language-plaintext highlighter-rouge">Merge</code>)</a>            <ul>
              <li><a href="#åŸºæœ¬æ–¹æ³•" id="markdown-toc-åŸºæœ¬æ–¹æ³•">åŸºæœ¬æ–¹æ³•</a></li>
              <li><a href="#ä¸¤ä¸ªç»“æ„ä½“çš„typeç›¸åŒ" id="markdown-toc-ä¸¤ä¸ªç»“æ„ä½“çš„typeç›¸åŒ">ä¸¤ä¸ªç»“æ„ä½“çš„typeç›¸åŒ</a></li>
              <li><a href="#ä¸¤ä¸ªç»“æ„ä½“çš„typeä¸åŒ" id="markdown-toc-ä¸¤ä¸ªç»“æ„ä½“çš„typeä¸åŒ">ä¸¤ä¸ªç»“æ„ä½“çš„typeä¸åŒ</a></li>
            </ul>
          </li>
          <li><a href="#private-object" id="markdown-toc-private-object"><code class="language-plaintext highlighter-rouge">Private object</code></a></li>
          <li><a href="#object" id="markdown-toc-object"><code class="language-plaintext highlighter-rouge">Object</code></a>            <ul>
              <li><a href="#get" id="markdown-toc-get">get</a></li>
              <li><a href="#set" id="markdown-toc-set">set</a></li>
              <li><a href="#unwrap" id="markdown-toc-unwrap">unwrap</a></li>
            </ul>
          </li>
          <li><a href="#ä¸€äº›å®šä¹‰" id="markdown-toc-ä¸€äº›å®šä¹‰">ä¸€äº›å®šä¹‰</a></li>
        </ul>
      </li>
      <li><a href="#é¢å‘åè®®" id="markdown-toc-é¢å‘åè®®">é¢å‘åè®®</a>        <ul>
          <li><a href="#indexå’Œcomparable" id="markdown-toc-indexå’Œcomparable"><code class="language-plaintext highlighter-rouge">Index</code>å’Œ<code class="language-plaintext highlighter-rouge">Comparable</code></a></li>
          <li><a href="#collection" id="markdown-toc-collection"><code class="language-plaintext highlighter-rouge">Collection</code></a></li>
          <li><a href="#ä¸‹æ ‡" id="markdown-toc-ä¸‹æ ‡">ä¸‹æ ‡</a></li>
          <li><a href="#raw" id="markdown-toc-raw">Raw</a></li>
          <li><a href="#æœ€åç»“æœ" id="markdown-toc-æœ€åç»“æœ">æœ€åç»“æœ</a>            <ul>
              <li><a href="#ä¸å«value" id="markdown-toc-ä¸å«value">ä¸å«<code class="language-plaintext highlighter-rouge">Value</code></a></li>
              <li><a href="#å«æœ‰value" id="markdown-toc-å«æœ‰value">å«æœ‰Value</a></li>
              <li><a href="#æœ€å" id="markdown-toc-æœ€å">æœ€å</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#é‡è½½æ“ä½œç¬¦" id="markdown-toc-é‡è½½æ“ä½œç¬¦">é‡è½½æ“ä½œç¬¦</a></li>
    </ul>
  </li>
  <li><a href="#æºç " id="markdown-toc-æºç ">æºç </a></li>
  <li><a href="#å‚è€ƒ" id="markdown-toc-å‚è€ƒ">å‚è€ƒ</a></li>
</ul>
<hr />

<h1 id="ç®€ä»‹">ç®€ä»‹</h1>

<p><a href="https://github.com/SwiftyJSON/SwiftyJSON">SwiftyJSON</a>æ˜¯ç”¨<code class="language-plaintext highlighter-rouge">swift</code>å†™çš„ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">JSON</code>è§£æåº“ã€‚ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œå¯¹å¼€å‘è€…å¾ˆå‹å¥½ã€‚</p>

<h1 id="åˆ†æ">åˆ†æ</h1>

<p>æºä»£ç éƒ½æ”¾åœ¨äº†<code class="language-plaintext highlighter-rouge">SwiftyJSON.swift</code>è¿™ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚</p>

<h2 id="ç»“æ„">ç»“æ„</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.ä¸€äº›é”™è¯¯ç å’Œ JSON type ç­‰ æšä¸¾
2.JSON ç»“æ„ä½“ï¼Œå®šä¹‰äº†JSONçš„æ•°æ®ç»“æ„å’Œæ„é€ æ–¹æ³•
3.ç´¢å¼•å’Œé›†åˆï¼Œä¸‹æ ‡ï¼Œå­—é¢å€¼ï¼Œæ§åˆ¶å°æ‰“å°ç­‰åŸºäºSwiftæ ‡å‡†åº“åè®®çš„ç‰¹æ€§å®ç°
4.ä»¥RowValueçš„å½¢å¼æŠŠJSONæ•°æ®è½¬åŒ–ä¸ºç”¨æˆ·æƒ³è¦çš„æ•°æ®ç±»å‹
5.è¿ç®—ç¬¦é‡è½½å®ç°JSONæ•°æ®çš„æ¯”è¾ƒ
</code></pre></div></div>

<h2 id="æµç¨‹">æµç¨‹</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.å‡è®¾æˆ‘ä»¬ä»æœåŠ¡å™¨æ‹¿åˆ°äº†{"description":"test"} çš„ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®Data
2.æŠŠDataé€šè¿‡JSONSerializationååºåˆ—åŒ–åï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œå°†å¾—åˆ°ä¸€ä¸ªAnyå¯¹è±¡ï¼Œæ­¤æ—¶æˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒé‡Œé¢å…·ä½“æ˜¯ä»€ä¹ˆ
3.æŠŠAnyå¯¹è±¡é€’å½’çš„è§£åŒ…ä¹‹åï¼Œå°±å¾—åˆ°äº†unwrapedObjectï¼Œå³å­—å…¸
{"description":"test"}
4.æ ¹æ®unwrapedObjectçš„ç±»å‹ï¼Œå¯¹ç»“æ„ä½“çš„typeå’ŒrowValueèµ‹å€¼ï¼Œä»¥æ–¹ä¾¿åç»­çš„ä½¿ç”¨
5.ä»¥objectå¯¹typeå’ŒrowValueè¿›è¡Œå°è£…ï¼Œæ–¹ä¾¿å¤–éƒ¨å¯¹JSONç»“æ„ä½“æ•°æ®çš„ä½¿ç”¨
</code></pre></div></div>

<h2 id="æ³¨é‡Š">æ³¨é‡Š</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ç±»å‹</th>
      <th style="text-align: center">æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">//</code></td>
      <td style="text-align: center">æ™®é€šçš„å•è¡Œæ³¨é‡Š</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">/* */</code></td>
      <td style="text-align: center">å¯åµŒå¥—çš„å¤šè¡Œæ³¨é‡Š</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">// MARK: -</code></td>
      <td style="text-align: center">åˆ†å‰²çº¿</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">// TODO:</code> |<code class="language-plaintext highlighter-rouge"> // FIXME:</code></td>
      <td style="text-align: center">æ·»åŠ todo|fixme</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">///</code></td>
      <td style="text-align: center">Xcodeä¼šæ·»åŠ è¯¥æ³¨é‡Šå†…å®¹åˆ°Quick Helpçš„Descriptionå­—æ®µ</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">/** */</code></td>
      <td style="text-align: center">å’Œ///ç±»ä¼¼ï¼Œä¸”å¯ä»¥é€šè¿‡æ·»åŠ parameterã€returnsç­‰å­—æ®µä¸ºå‡½æ•°çš„ä½¿ç”¨æä¾›æ›´å¤šçš„ä¿¡æ¯</td>
    </tr>
  </tbody>
</table>

<h2 id="è®¿é—®æƒé™">è®¿é—®æƒé™</h2>

<h3 id="å¯¹äºfunc">å¯¹äº<code class="language-plaintext highlighter-rouge">func</code></h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ç±»å‹</th>
      <th style="text-align: center">æ–‡ä»¶å†…</th>
      <th style="text-align: center">æ¨¡å—(Module)å†…</th>
      <th style="text-align: center">å…¶ä»–æ¨¡å—</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">open</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">public</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">å¯è®¿é—®,ä¸å¯é‡è½½</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">internal</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œé‡è½½</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">fileprivate</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œé‡è½½</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">private</code></td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œé‡è½½</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œé‡è½½</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">final</code>ä¿®é¥°çš„<code class="language-plaintext highlighter-rouge">func</code>åœ¨ä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½è¢«é‡è½½ï¼ˆ<code class="language-plaintext highlighter-rouge">overwrite</code>ï¼‰</p>

<p><code class="language-plaintext highlighter-rouge">func</code>é»˜è®¤ä½¿ç”¨<code class="language-plaintext highlighter-rouge">internal</code></p>

<h3 id="å¯¹äºclass">å¯¹äº<code class="language-plaintext highlighter-rouge">class</code></h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ç±»å‹</th>
      <th style="text-align: center">æ–‡ä»¶å†…</th>
      <th style="text-align: center">æ¨¡å—(<code class="language-plaintext highlighter-rouge">Module</code>)å†…</th>
      <th style="text-align: center">å…¶ä»–æ¨¡å—</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">open</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">public</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">å¯è®¿é—®,ä¸å¯ç»§æ‰¿</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">internal</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œç»§æ‰¿</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">fileprivate</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œç»§æ‰¿</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">private</code></td>
      <td style="text-align: center">å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œç»§æ‰¿</td>
      <td style="text-align: center">ä¸å¯è®¿é—®å’Œç»§æ‰¿</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">final</code>ä¿®é¥°çš„<code class="language-plaintext highlighter-rouge">class</code>åœ¨ä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½è¢«ç»§æ‰¿</p>

<p><code class="language-plaintext highlighter-rouge">class</code>é»˜è®¤ä½¿ç”¨<code class="language-plaintext highlighter-rouge">internal</code></p>

<h2 id="é”™è¯¯">é”™è¯¯</h2>

<p>è¿™äº›æ˜¯å·²ç»è¿‡æ—¶çš„</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Error domain</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorDomain is deprecated. Use `SwiftyJSONError.errorDomain` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.errorDomain"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorDomain</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"SwiftyJSONErrorDomain"</span>

<span class="c1">/// Error code</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorUnsupportedType is deprecated. Use `SwiftyJSONError.unsupportedType` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.unsupportedType"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorUnsupportedType</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">999</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorIndexOutOfBounds is deprecated. Use `SwiftyJSONError.indexOutOfBounds` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.indexOutOfBounds"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorIndexOutOfBounds</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">900</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorWrongType is deprecated. Use `SwiftyJSONError.wrongType` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.wrongType"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorWrongType</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">901</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorNotExist is deprecated. Use `SwiftyJSONError.notExist` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.notExist"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorNotExist</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">500</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorInvalidJSON is deprecated. Use `SwiftyJSONError.invalidJSON` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.invalidJSON"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorInvalidJSON</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">490</span>
</code></pre></div></div>

<p>ç°åœ¨çš„æ˜¯è¿™æ ·</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SwiftyJSON é”™è¯¯</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">SwiftyJSONError</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">unsupportedType</span> <span class="o">=</span> <span class="mi">999</span>
    <span class="k">case</span> <span class="n">indexOutOfBounds</span> <span class="o">=</span> <span class="mi">900</span>
    <span class="k">case</span> <span class="n">elementTooDeep</span> <span class="o">=</span> <span class="mi">902</span>
    <span class="k">case</span> <span class="n">wrongType</span> <span class="o">=</span> <span class="mi">901</span>
    <span class="k">case</span> <span class="n">notExist</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="k">case</span> <span class="n">invalidJSON</span> <span class="o">=</span> <span class="mi">490</span>
<span class="p">}</span>

<span class="c1">// SwiftyJSON é”™è¯¯ extension</span>
<span class="kd">extension</span> <span class="kt">SwiftyJSONError</span><span class="p">:</span> <span class="kt">CustomNSError</span> <span class="p">{</span>

    <span class="c1">/// return the error domain of SwiftyJSONError</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">errorDomain</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"com.swiftyjson.SwiftyJSON"</span> <span class="p">}</span>

    <span class="c1">/// return the error code of SwiftyJSONError</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">errorCode</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawValue</span> <span class="p">}</span>

    <span class="c1">/// return the userInfo of SwiftyJSONError</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">errorUserInfo</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">unsupportedType</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"It is an unsupported type."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">indexOutOfBounds</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Array Index is out of bounds."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">wrongType</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Couldn't merge, because the JSONs differ in type on top level."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Dictionary key does not exist."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">invalidJSON</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"JSON is invalid."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">elementTooDeep</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Element too deep. Increase maxObjectDepth and make sure there is no reference loop."</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œåªæœ‰<code class="language-plaintext highlighter-rouge">get</code>å±æ€§ã€‚</p>

<h2 id="swiftyjsonä¸­jsonçš„ç±»å‹"><code class="language-plaintext highlighter-rouge">SwiftyJSON</code>ä¸­<code class="language-plaintext highlighter-rouge">JSON</code>çš„ç±»å‹</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - JSON Type</span>

<span class="cm">/**
JSON's type definitions.

See http://www.json.org
*/</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="k">Type</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">number</span>
	<span class="k">case</span> <span class="n">string</span>
	<span class="k">case</span> <span class="n">bool</span>
	<span class="k">case</span> <span class="n">array</span>
	<span class="k">case</span> <span class="n">dictionary</span>
	<span class="k">case</span> <span class="n">null</span>
	<span class="k">case</span> <span class="n">unknown</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¸<code class="language-plaintext highlighter-rouge">type</code>å¯¹åº”çš„<code class="language-plaintext highlighter-rouge">rawValue</code>ï¼Œç”¨äºå­˜å‚¨è¿›è¡Œè¿‡ç±»å‹è½¬æ¢åçš„æœ€ç»ˆç»“æœã€‚åœ¨<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“é‡Œé¢ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Private object</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawArray</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawDictionary</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawString</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawNumber</span><span class="p">:</span> <span class="kt">NSNumber</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawNull</span><span class="p">:</span> <span class="kt">NSNull</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawBool</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
</code></pre></div></div>

<h2 id="jsonserialization"><code class="language-plaintext highlighter-rouge">JSONSerialization</code></h2>

<p><code class="language-plaintext highlighter-rouge">JSONSerialization</code>æ˜¯è‹¹æœç”¨äºåºåˆ—åŒ–/ååºåˆ—åŒ–<code class="language-plaintext highlighter-rouge">JSON</code>æ•°æ®çš„ç±»ï¼Œå…¶å¯ä»¥å®ç°JSONçš„äºŒè¿›åˆ¶æ•°æ®<code class="language-plaintext highlighter-rouge">Data</code>å’Œ<code class="language-plaintext highlighter-rouge">Any</code>å¯¹è±¡çš„ç›¸äº’è½¬åŒ–ã€‚ç”±äº<code class="language-plaintext highlighter-rouge">Data</code>å¹¶ä¸ä¸€å®šèƒ½ååºåˆ—åŒ–ä¸º<code class="language-plaintext highlighter-rouge">Any</code>å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œé”™è¯¯å¤„ç†ã€‚ç”±äºå¾—åˆ°çš„æ˜¯<code class="language-plaintext highlighter-rouge">Any</code>ç±»å‹ï¼Œæ‰€ä»¥å½“å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜å¿…é¡»è¿›è¡Œå¤šæ¬¡çš„è½¬å‹å’Œåˆ¤æ–­ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">do</span> <span class="p">{</span>
  <span class="k">let</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"è§£æå¤±è´¥"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç°åœ¨çš„<code class="language-plaintext highlighter-rouge">JSON</code>è§£æåº“åŸºæœ¬éƒ½æ˜¯åŸºäº<code class="language-plaintext highlighter-rouge">JSONSerialization</code></p>

<h2 id="jsonç»“æ„ä½“"><code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“</h2>

<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>

<p>ä»è¾“å…¥æºè€ƒè™‘ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>äºŒè¿›åˆ¶æ•°æ®Data
JSONå­—ç¬¦ä¸²String
ä»»æ„ç±»å‹Any
</code></pre></div></div>

<p>è™½ç„¶æœ‰å¤šç§å¯èƒ½çš„è¾“å…¥æºï¼Œä½†æ˜¯æœ€ç»ˆçš„é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œå³é€šè¿‡ä¸€ä¸ªè§£æåçš„<code class="language-plaintext highlighter-rouge">Any</code>å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ª<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæœ€ç»ˆç”Ÿæˆ<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“çš„é€»è¾‘å°è£…æˆä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•(<code class="language-plaintext highlighter-rouge">Designated Initializer</code>)ï¼Œå…¶ä»–çš„æ‰€æœ‰åˆå§‹åŒ–æ–¹æ³•åˆ™æ˜¯å¯¹è¾“å…¥è¿›è¡Œç›¸åº”çš„å¤„ç†åï¼Œå†ä»£ç†ç»™æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ã€‚(ä¸¥æ ¼æ¥è¯´ï¼ŒæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ˜¯ä½œç”¨äº<code class="language-plaintext highlighter-rouge">Class</code>ï¼Œç›¸å¯¹äº<code class="language-plaintext highlighter-rouge">Convenience Initializers</code>æ¥è¯´çš„ï¼Œä½†æ˜¯å…¶æ€æƒ³åŒæ ·å¯ä»¥ç”¨äº<code class="language-plaintext highlighter-rouge">Struct</code>)</p>

<p>å…·ä½“çš„åˆå§‹åŒ–æ–¹æ³•åˆ†æå¦‚ä¸‹ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Creates a JSON using the object.

 - parameter jsonObject:  The object must have the following properties: All objects are NSString/String, NSNumber/Int/Float/Double/Bool, NSArray/Array, NSDictionary/Dictionary, or NSNull; All dictionary keys are NSStrings/String; NSNumbers are not NaN or infinity.

 - returns: The created JSON
 */</span>
<span class="kd">fileprivate</span> <span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">jsonObject</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä½¿ç”¨è¿™ä¸ªç§æœ‰æ–¹æ³•åˆå§‹åŒ–ï¼Œé€šè¿‡å‚æ•°<code class="language-plaintext highlighter-rouge">jsonObject</code>åˆ›å»º<code class="language-plaintext highlighter-rouge">JOSN</code>ç»“æ„ä½“å®ä¾‹å¹¶åˆå§‹åŒ–<code class="language-plaintext highlighter-rouge">object</code>å±æ€§ã€‚<code class="language-plaintext highlighter-rouge">self.object = jsonObject</code>ä¼šå»è°ƒç”¨<code class="language-plaintext highlighter-rouge">object</code>çš„<code class="language-plaintext highlighter-rouge">set</code>æ–¹æ³•ã€‚</p>

<h4 id="äºŒè¿›åˆ¶æ•°æ®data">äºŒè¿›åˆ¶æ•°æ®<code class="language-plaintext highlighter-rouge">Data</code></h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Creates a JSON using the data.

 - parameter data: The NSData used to convert to json.Top level object in data is an NSArray or NSDictionary
 - parameter opt: The JSON serialization reading options. `[]` by default.

 - returns: The created JSON
 */</span>
<span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="n">options</span> <span class="nv">opt</span><span class="p">:</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">ReadingOptions</span> <span class="o">=</span> <span class="p">[])</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span> <span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">opt</span><span class="p">)</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="n">object</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è°ƒç”¨ç³»ç»Ÿçš„<code class="language-plaintext highlighter-rouge">JSONSerialization</code>å¯¹<code class="language-plaintext highlighter-rouge">Data</code>è¿›è¡Œè§£æï¼Œç„¶åæ‰§è¡ŒåŸºæœ¬åˆå§‹åŒ–æ–¹æ³•<code class="language-plaintext highlighter-rouge">fileprivate init(jsonObject: Any)</code>ã€‚</p>

<h4 id="ä»»æ„ç±»å‹any">ä»»æ„ç±»å‹Any</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Creates a JSON object
 - note: this does not parse a `String` into JSON, instead use `init(parseJSON: String)`

 - parameter object: the object

 - returns: the created JSON object
 */</span>
<span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">object</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">object</span> <span class="k">as</span> <span class="kt">Data</span><span class="p">:</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">object</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="kt">NSNull</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="n">object</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å› ä¸ºæ­¤<code class="language-plaintext highlighter-rouge">Any</code>ä¸ä¸€å®šæ˜¯<code class="language-plaintext highlighter-rouge">JSONSerialization</code>è§£æåçš„<code class="language-plaintext highlighter-rouge">Any</code>ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯<code class="language-plaintext highlighter-rouge">Data</code>ç±»å‹ã€‚æ‰€ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯<code class="language-plaintext highlighter-rouge">Data</code>åˆ™æ‰§è¡ŒåŸºæœ¬åˆå§‹åŒ–æ–¹æ³•<code class="language-plaintext highlighter-rouge">public init(data: Data, options opt: JSONSerialization.ReadingOptions = [])</code>ï¼Œå¦åˆ™æ‰§è¡ŒåŸºæœ¬åˆå§‹åŒ–æ–¹æ³•<code class="language-plaintext highlighter-rouge">fileprivate init(jsonObject: Any)</code></p>

<h4 id="jsonå­—ç¬¦ä¸²string"><code class="language-plaintext highlighter-rouge">JSON</code>å­—ç¬¦ä¸²<code class="language-plaintext highlighter-rouge">String</code></h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Parses the JSON string into a JSON object

 - parameter json: the JSON string

 - returns: the created JSON object
*/</span>
<span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">parseJSON</span> <span class="nv">jsonString</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="kt">NSNull</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>é€šè¿‡å­—ç¬¦ä¸²åˆ›å»º<code class="language-plaintext highlighter-rouge">Data</code>ï¼Œå†æ‰§è¡Œæ–¹æ³•<code class="language-plaintext highlighter-rouge">public init(_ object: Any)</code>ï¼Œå¦‚æœåˆ›å»ºå¤±è´¥ï¼Œåˆ™é€šè¿‡æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ„é€ ä¸€ä¸ªç©º<code class="language-plaintext highlighter-rouge">JSON</code></p>

<h3 id="åˆå¹¶merge">åˆå¹¶(<code class="language-plaintext highlighter-rouge">Merge</code>)</h3>

<p>é™¤äº†åˆå§‹åŒ–å¤–ï¼Œè¿˜æä¾›äº†åˆå¹¶ä¸¤ä¸ª<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“çš„æ–¹æ³•ã€‚</p>

<p>æ–¹æ³•ä¸­ä½¿ç”¨äº†<code class="language-plaintext highlighter-rouge">mutating</code>å…³é”®å­—ï¼Œå…¶ä½œç”¨æ˜¯ä½¿å¾—æ–¹æ³•å¯ä»¥ä¿®æ”¹è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹æœ¬èº«ï¼Œå³<code class="language-plaintext highlighter-rouge">self</code>ã€‚</p>

<h4 id="åŸºæœ¬æ–¹æ³•">åŸºæœ¬æ–¹æ³•</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Private woker function which does the actual merging
 Typecheck is set to true for the first recursion level to prevent total override of the source JSON
*/</span>
<span class="kd">fileprivate</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">merge</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">in</span> <span class="n">other</span> <span class="p">{</span>
                <span class="k">try</span> <span class="k">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="nf">merge</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">self</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">arrayValue</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">arrayValue</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">self</span> <span class="o">=</span> <span class="n">other</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">typecheck</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">wrongType</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span> <span class="o">=</span> <span class="n">other</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ–¹æ³•ä¸­ä½¿ç”¨äº†<code class="language-plaintext highlighter-rouge">mutating</code>å…³é”®å­—ï¼Œå…¶ä½œç”¨æ˜¯ä½¿å¾—æ–¹æ³•å¯ä»¥ä¿®æ”¹è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹æœ¬èº«ï¼Œå³<code class="language-plaintext highlighter-rouge">self</code></p>

<p>å¦‚æœæ˜¯é™¤å­—å…¸å’Œæ•°æ®å¤–çš„ç±»å‹ï¼Œç›´æ¥æ›¿æ¢ä¸ºæ–°çš„æ•°æ®</p>

<p>å¦‚æœæ˜¯æ•°ç»„ï¼ŒæŠŠä¸¤ä¸ªæ•°ç»„çš„å†…å®¹åˆå¹¶</p>

<p>å¦‚æœæ˜¯å­—å…¸ï¼Œéå†å­—å…¸ï¼Œå¦‚æœ<code class="language-plaintext highlighter-rouge">key</code>ç›¸åŒï¼Œé€’å½’çš„è°ƒç”¨åˆå¹¶æ–¹æ³•æŠŠå¯¹åº”çš„<code class="language-plaintext highlighter-rouge">value</code>è¿›è¡Œåˆå¹¶ï¼Œå¹¶é™„åŠ ä¸€ä¸ªæ ‡å¿—<code class="language-plaintext highlighter-rouge">typecheck</code></p>

<h4 id="ä¸¤ä¸ªç»“æ„ä½“çš„typeç›¸åŒ">ä¸¤ä¸ªç»“æ„ä½“çš„typeç›¸åŒ</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Merges another JSON into this JSON, whereas primitive values which are not present in this JSON are getting added,
 present values getting overwritten, array values getting appended and nested JSONs getting merged the same way.

 - parameter other: The JSON which gets merged into this JSON

 - throws `ErrorWrongType` if the other JSONs differs in type on the top level.
 */</span>
<span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">merge</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">merge</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">other</span><span class="p">,</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è°ƒç”¨ç§æœ‰çš„åŸºæœ¬åˆå¹¶æ–¹æ³•</p>

<h4 id="ä¸¤ä¸ªç»“æ„ä½“çš„typeä¸åŒ">ä¸¤ä¸ªç»“æ„ä½“çš„typeä¸åŒ</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Merges another JSON into this JSON and returns a new JSON, whereas primitive values which are not present in this JSON are getting added,
 present values getting overwritten, array values getting appended and nested JSONS getting merged the same way.

 - parameter other: The JSON which gets merged into this JSON

 - throws `ErrorWrongType` if the other JSONs differs in type on the top level.

 - returns: New merged JSON
 */</span>
<span class="kd">public</span> <span class="kd">func</span> <span class="nf">merged</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">merged</span> <span class="o">=</span> <span class="k">self</span>
    <span class="k">try</span> <span class="n">merged</span><span class="o">.</span><span class="nf">merge</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">other</span><span class="p">,</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœ<code class="language-plaintext highlighter-rouge">typecheck</code>ä¸ºçœŸè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªç»“æ„ä½“çš„æœ€å¤–å±‚ç»“æ„æ˜¯ä¸ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ— æ³•åˆå¹¶ï¼ŒæŠ›å‡ºå®šä¹‰å¥½çš„<code class="language-plaintext highlighter-rouge">NSError</code>é”™è¯¯</p>

<p>å¦‚æœ<code class="language-plaintext highlighter-rouge">typecheck</code>ä¸ºå‡è¯´æ˜æ˜¯éå†å­—å…¸æ—¶é€’å½’è°ƒç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªç»“æ„ä½“çš„æœ€å¤–å±‚ç»“æ„æ˜¯ä¸€æ ·ï¼Œåªä¸è¿‡é‡Œå±‚çš„ç»“æ„ä¸åŒï¼Œé‚£ä¹ˆæŠŠé‡Œé¢çš„æ•°æ®ç›´æ¥æ›¿æ¢ä¸ºæ–°çš„æ•°æ®</p>

<h3 id="private-object"><code class="language-plaintext highlighter-rouge">Private object</code></h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Private object</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawArray</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawDictionary</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawString</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawNumber</span><span class="p">:</span> <span class="kt">NSNumber</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawNull</span><span class="p">:</span> <span class="kt">NSNull</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
<span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawBool</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">/// JSON type, fileprivate setter</span>
<span class="kd">public</span> <span class="nf">fileprivate</span><span class="p">(</span><span class="k">set</span><span class="p">)</span> <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="k">Type</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>

<span class="c1">/// Error in JSON, fileprivate setter</span>
<span class="kd">public</span> <span class="nf">fileprivate</span><span class="p">(</span><span class="k">set</span><span class="p">)</span> <span class="k">var</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">SwiftyJSONError</span><span class="p">?</span>

</code></pre></div></div>

<h3 id="object"><code class="language-plaintext highlighter-rouge">Object</code></h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Object in JSON</span>
<span class="kd">public</span> <span class="k">var</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNull</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="k">switch</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">newValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="k">let</span> <span class="nv">number</span> <span class="k">as</span> <span class="kt">NSNumber</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">isBool</span> <span class="p">{</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">bool</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">boolValue</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">number</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">=</span> <span class="n">number</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="k">let</span> <span class="nv">string</span> <span class="k">as</span> <span class="kt">String</span><span class="p">:</span>
            <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">string</span>
            <span class="k">self</span><span class="o">.</span><span class="n">rawString</span> <span class="o">=</span> <span class="n">string</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">as</span> <span class="kt">NSNull</span><span class="p">:</span>
            <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>
        <span class="k">case</span> <span class="nv">nil</span><span class="p">:</span>
            <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>
        <span class="k">case</span> <span class="k">let</span> <span class="nv">array</span> <span class="k">as</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]:</span>
            <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">array</span>
            <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">case</span> <span class="k">let</span> <span class="nv">dictionary</span> <span class="k">as</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]:</span>
            <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">dictionary</span>
            <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="o">=</span> <span class="n">dictionary</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">unknown</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">unsupportedType</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="get">get</h4>

<p>æ ¹æ®<code class="language-plaintext highlighter-rouge">type</code>æ¥åˆ¤æ–­è¯¥è¿”å›ä»€ä¹ˆ</p>

<h4 id="set">set</h4>

<p>æŠŠ<code class="language-plaintext highlighter-rouge">Any</code>å¯¹è±¡é€’å½’çš„è§£åŒ…ä¹‹åï¼Œå°±å¾—åˆ°äº†<code class="language-plaintext highlighter-rouge">unwrapedObject</code></p>

<p>æ ¹æ®<code class="language-plaintext highlighter-rouge">unwrapedObject</code>çš„ç±»å‹ï¼Œå¯¹ç»“æ„ä½“çš„<code class="language-plaintext highlighter-rouge">type</code>å’Œ<code class="language-plaintext highlighter-rouge">rowValue</code>èµ‹å€¼ï¼Œä»¥æ–¹ä¾¿åç»­çš„ä½¿ç”¨</p>

<p>ä»¥<code class="language-plaintext highlighter-rouge">object</code>å¯¹<code class="language-plaintext highlighter-rouge">type</code>å’Œ<code class="language-plaintext highlighter-rouge">rowValue</code>è¿›è¡Œå°è£…ï¼Œæ–¹ä¾¿å¤–éƒ¨å¯¹<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“æ•°æ®çš„ä½¿ç”¨</p>

<h4 id="unwrap">unwrap</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Private method to unwarp an object recursively</span>
<span class="kd">private</span> <span class="kd">func</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">_</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Any</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">object</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">json</span> <span class="k">as</span> <span class="kt">JSON</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">array</span> <span class="k">as</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">unwrap</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">dictionary</span> <span class="k">as</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]:</span>
        <span class="k">var</span> <span class="nv">unwrappedDic</span> <span class="o">=</span> <span class="n">dictionary</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">in</span> <span class="n">dictionary</span> <span class="p">{</span>
            <span class="n">unwrappedDic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">unwrappedDic</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">object</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æŠŠ<code class="language-plaintext highlighter-rouge">Any</code>å¯¹è±¡é€’å½’è§£åŒ…</p>

<h3 id="ä¸€äº›å®šä¹‰">ä¸€äº›å®šä¹‰</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// The static null JSON</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">unavailable</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span><span class="s">"null"</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">nullJSON</span><span class="p">:</span> <span class="kt">JSON</span> <span class="p">{</span> <span class="k">return</span> <span class="n">null</span> <span class="p">}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">null</span><span class="p">:</span> <span class="kt">JSON</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">JSON</span><span class="p">(</span><span class="kt">NSNull</span><span class="p">())</span> <span class="p">}</span>
</code></pre></div></div>

<h2 id="é¢å‘åè®®">é¢å‘åè®®</h2>

<p>å¯¹äº<code class="language-plaintext highlighter-rouge">JSON</code>æ¥è¯´ï¼Œæœ€å¤–å±‚éœ€è¦æ˜¯<code class="language-plaintext highlighter-rouge">Dictionary</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">Array</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯é›†åˆç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥æŠŠ<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“æ‰©å±•ä¸º<code class="language-plaintext highlighter-rouge">Swift</code>çš„é›†åˆç±»å‹ï¼Œå³å®ç°<code class="language-plaintext highlighter-rouge">Swift.Collection</code>åè®®ã€‚å› ä¸º<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“çš„å†…éƒ¨æ•°æ®å¯èƒ½ä¸ºå¤šç§ç±»å‹ï¼Œè¦æ‰©å±•ä¸ºé›†åˆï¼Œå°±è¦å…ˆå®šä¹‰ä¸€ç§ç»Ÿä¸€çš„ç´¢å¼•æ–¹å¼ã€‚è€Œä½œä¸ºç´¢å¼•ï¼Œå…¶æœ¬èº«å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»å®ç°<code class="language-plaintext highlighter-rouge">Comparable</code>åè®®ã€‚</p>

<h3 id="indexå’Œcomparable"><code class="language-plaintext highlighter-rouge">Index</code>å’Œ<code class="language-plaintext highlighter-rouge">Comparable</code></h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="kt">Index</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Any</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Comparable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">array</span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">dictionary</span><span class="p">(</span><span class="kt">DictionaryIndex</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">null</span>

    <span class="kd">static</span> <span class="kd">public</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span> <span class="k">return</span> <span class="kc">true</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¯¹äº<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å®šä¹‰äº†7ç§ç±»å‹ï¼Œä½†æ˜¯ä½œä¸ºç´¢å¼•ï¼Œåªéœ€è¦é’ˆå¯¹<code class="language-plaintext highlighter-rouge">.array</code>ã€<code class="language-plaintext highlighter-rouge">.dictionary</code>å’Œ<code class="language-plaintext highlighter-rouge">.null</code>ï¼Œå…¶ä»–ç±»å‹æœ¬èº«å°±æ˜¯ä¸€ä¸ªå®ä½“ï¼Œæ²¡æœ‰ç´¢å¼•çš„æ¦‚å¿µ(<code class="language-plaintext highlighter-rouge">.string</code>æœ¬èº«æ˜¯æœ‰ç´¢å¼•çš„ï¼Œä¸è¿‡æˆ‘ä»¬ä¸éœ€è¦æŠŠå­—ç¬¦ä¸²ç»™æ‹†æˆå­—ç¬¦)ã€‚æ‰€ä»¥å£°æ˜ä¸€ä¸ªæšä¸¾ï¼ŒæŠŠä¸Šè¿°ä¸‰ç§æƒ…å†µç»Ÿä¸€ä¸ºä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Index</code>ï¼Œå¹¶å®ç°<code class="language-plaintext highlighter-rouge">Comparable</code>åè®®ã€‚
<code class="language-plaintext highlighter-rouge">Comparable</code>åè®®å®é™…å°±æ˜¯é‡è½½æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå¦‚<code class="language-plaintext highlighter-rouge">==</code> ã€<code class="language-plaintext highlighter-rouge">&lt;</code>ç­‰ï¼Œè®©ä¸¤ä¸ªåŒç±»å‹çš„å®ä¾‹å¯ä»¥è¿›è¡Œæ¯”è¾ƒï¼Œåè®®çš„æ¦‚å¿µå’Œå®ç°çš„é€»è¾‘éƒ½æ¯”è¾ƒç®€å•ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">public</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span> <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">static</span> <span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="collection"><code class="language-plaintext highlighter-rouge">Collection</code></h3>

<p><code class="language-plaintext highlighter-rouge">Collection</code>åè®®å¯ä»¥ä¸ºå®ç°è¯¥åè®®çš„ç±»å‹æä¾›å‡ ä¹å…¨éƒ¨é›†åˆå¸¸ç”¨çš„ç‰¹æ€§ï¼Œå¦‚é€šè¿‡ä¸‹æ ‡è·å–é›†åˆå…ƒç´ ï¼Œ<code class="language-plaintext highlighter-rouge">forâ€¦in</code>éå†é›†åˆå…ƒç´ ï¼Œ<code class="language-plaintext highlighter-rouge">count isEmpty indices</code>ç­‰å¸¸ç”¨å±æ€§ï¼Œå…ƒç´ æ“ä½œã€è·ç¦»ã€åˆ‡ç‰‡ã€è¿­ä»£å™¨ç­‰å¸¸ç”¨æ–¹æ³•ã€‚</p>

<p>éµå®ˆ<code class="language-plaintext highlighter-rouge">Collection</code>åè®®è‡³å°‘å¿…é¡»æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>startIndexå’ŒendIndexå±æ€§ç”¨æ¥å®šä¹‰å…ƒç´ çš„èµ·å§‹
subscriptç‰¹æ€§ç”¨æ¥é€šè¿‡ä¸‹æ ‡è·å–é›†åˆå†…éƒ¨å…ƒç´ 
index(after:)æ–¹æ³•ç”¨æ¥ç¡®å®šå…ƒç´ çš„æ’åˆ—é¡ºåº
</code></pre></div></div>

<p>ç†è§£èµ·æ¥ä¹Ÿå¾ˆæ¸…æ™°æ˜äº†ï¼Œä¸€ä¸ªé›†åˆé€šè¿‡<code class="language-plaintext highlighter-rouge">subscript</code>ç‰¹æ€§æŠŠç´¢å¼•å’Œå†…éƒ¨çš„å…ƒç´ ç»‘å®šï¼Œå¹¶ä¸”ç¡®å®šäº†èµ·å§‹ä½ç½®çš„ç´¢å¼•å’Œå…¶ä»–ç´¢å¼•çš„åç»§ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†åˆå†…éƒ¨çš„å…ƒç´ å°±å·²ç»å…¨éƒ¨ç¡®å®šä¸”å¯çŸ¥çš„äº†ã€‚</p>

<p>è€Œç”±äº<code class="language-plaintext highlighter-rouge">Array</code>å’Œ<code class="language-plaintext highlighter-rouge">Dictionary</code>éƒ½å·²ç»æ˜¯é›†åˆç±»å‹äº†ï¼Œæˆ‘ä»¬å®šä¹‰çš„<code class="language-plaintext highlighter-rouge">Index</code>åªæ˜¯é€šè¿‡æšä¸¾å¯¹å‡ ç§æƒ…å†µè¿›è¡Œäº†ç»Ÿä¸€ï¼Œé‚£ä¹ˆå®ç°åè®®çš„æ—¶å€™ä¹Ÿåªéœ€è¦å¯¹<code class="language-plaintext highlighter-rouge">Index</code>ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè°ƒç”¨<code class="language-plaintext highlighter-rouge">Array</code>å’Œ<code class="language-plaintext highlighter-rouge">Dictionary</code>æœ¬èº«çš„ç›¸å…³å®ç°å³å¯ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">JSONIndex</span> <span class="o">=</span> <span class="kt">Index</span><span class="o">&lt;</span><span class="kt">JSON</span><span class="o">&gt;</span>
<span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">JSONRawIndex</span> <span class="o">=</span> <span class="kt">Index</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Collection</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">Index</span> <span class="o">=</span> <span class="kt">JSONRawIndex</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">startIndex</span><span class="p">:</span> <span class="kt">Index</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rawArray</span><span class="o">.</span><span class="n">startIndex</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="n">rawDictionary</span><span class="o">.</span><span class="n">startIndex</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">endIndex</span><span class="p">:</span> <span class="kt">Index</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rawArray</span><span class="o">.</span><span class="n">endIndex</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="n">rawDictionary</span><span class="o">.</span><span class="n">endIndex</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">index</span><span class="p">(</span><span class="n">after</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Index</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">i</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rawArray</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">after</span><span class="p">:</span> <span class="n">idx</span><span class="p">))</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="n">rawDictionary</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">after</span><span class="p">:</span> <span class="n">idx</span><span class="p">))</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">subscript</span> <span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">JSON</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">position</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="nf">return</span> <span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="kt">JSON</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="k">let</span> <span class="p">(</span><span class="nv">key</span><span class="p">,</span> <span class="nv">value</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nf">return</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nf">return</span> <span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="kt">JSON</span><span class="o">.</span><span class="n">null</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ä¸‹æ ‡">ä¸‹æ ‡</h3>

<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹æ ‡è®¿é—®<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“äº†ï¼Œä¸è¿‡ç°åœ¨ä¸‹æ ‡å¿…é¡»æ˜¯æšä¸¾ä¸”æ˜ç¡®å…¶ç±»å‹ï¼Œç”¨èµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ç§æ›´æ–¹ä¾¿çš„æ–¹æ³•æ¥ç¡®å®šä¸‹æ ‡ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">Array</code>çš„ä¸‹æ ‡æ˜¯<code class="language-plaintext highlighter-rouge">Int</code>ç±»å‹ï¼Œè€Œ<code class="language-plaintext highlighter-rouge">Dictionary</code>çš„ä¸‹æ ‡æ˜¯<code class="language-plaintext highlighter-rouge">String</code>ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®ç°æ–°çš„<code class="language-plaintext highlighter-rouge">subscript</code>ï¼Œé€šè¿‡å‚æ•°çš„ç±»å‹æ¥è°ƒç”¨ç›¸å¯¹åº”çš„å®ç°ã€‚</p>

<p>é¦–å…ˆåˆ†åˆ«å®ç°<code class="language-plaintext highlighter-rouge">Int</code>å’Œ<code class="language-plaintext highlighter-rouge">String</code>ç±»å‹å‚æ•°çš„<code class="language-plaintext highlighter-rouge">subscript</code>ï¼Œé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œåˆ¤æ–­ç±»å‹åï¼Œå¦‚æœç´¢å¼•æ˜¯åˆæ³•çš„åˆ™è¿”å›ç´¢å¼•ç›¸å¯¹åº”å…ƒç´ çš„<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“å®ä¾‹ï¼Œå¦åˆ™ç”Ÿæˆç›¸åº”çš„é”™è¯¯å¹¶èµ‹å€¼åˆ°ç©º<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ç„¶åè¿”å›ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">SwiftyJSON</code>å®šä¹‰äº†ä¸€ä¸ªåè®®<code class="language-plaintext highlighter-rouge">JSONSubscriptType</code>ï¼Œè®©<code class="language-plaintext highlighter-rouge">Int</code>å’Œ<code class="language-plaintext highlighter-rouge">String</code>éƒ½å»å®ç°è¯¥åè®®ï¼Œè¿™æ ·å‚æ•°çš„ç±»å‹å°±ç»Ÿä¸€äº†ã€‚ç„¶åå†è¿›è¡Œåˆ¤æ–­ã€è°ƒç”¨ç›¸åº”çš„<code class="language-plaintext highlighter-rouge">subscript</code>å®ç°</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 *  To mark both String and Int can be used in subscript.
 */</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">JSONKey</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">index</span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">key</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">JSONSubscriptType</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">jsonKey</span><span class="p">:</span> <span class="kt">JSONKey</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Int</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">jsonKey</span><span class="p">:</span> <span class="kt">JSONKey</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">JSONKey</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">String</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">jsonKey</span><span class="p">:</span> <span class="kt">JSONKey</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">JSONKey</span><span class="o">.</span><span class="nf">key</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™æ ·æˆ‘ä»¬ç»ˆäºå¯ä»¥å¼€å¿ƒçš„ä»¥<code class="language-plaintext highlighter-rouge">json["name"]</code>è¿™ä¹ˆæ„‰å¿«çš„æ–¹å¼æ¥è·å–<code class="language-plaintext highlighter-rouge">JSON</code>å†…éƒ¨æ•°æ®äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ¥å–ä¸€ä¸‹å†…éƒ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé—®é¢˜åˆæ¥äº†ï¼Œè¿™ç§å¤æ‚ç»“æ„çš„æ•°æ®åˆåº”è¯¥æ€ä¹ˆè·å–å‘¢ï¼Ÿ</p>

<p><code class="language-plaintext highlighter-rouge">SwiftyJSON</code>æä¾›äº†ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ä»¥æ•°ç»„å‚æ•°çš„å½¢å¼ï¼Œä¸€ç§æ˜¯ä¸å®šå‚æ•°åˆ—è¡¨çš„å½¢å¼ï¼Œä¸¤ç§æ–¹å¼é™¤äº†å‚æ•°è¡¨ç°å½¢å¼ä¸åŒï¼Œå…¶å®ç°é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚åœ¨<code class="language-plaintext highlighter-rouge">get</code>é€»è¾‘ä¸­ï¼Œé€šè¿‡ä¾æ¬¡è°ƒç”¨ä¸Šé¢çš„<code class="language-plaintext highlighter-rouge">subscript</code>æ¥è·å–æœ€ç»ˆçš„ç»“æœï¼Œåœ¨<code class="language-plaintext highlighter-rouge">set</code>é€»è¾‘ä¸­ï¼Œå¦‚æœä¸‹æ ‡ä¸ªæ•°æ˜¯0ç›´æ¥è¿”å›ï¼Œæ˜¯1ä¸ªé€šè¿‡ä¸Šé¢çš„<code class="language-plaintext highlighter-rouge">subscript</code>å»è®¾ç½®ï¼Œå¦‚æœå¤šäº1ä¸ªï¼Œä»¥é€’å½’çš„æ–¹å¼ï¼Œé€å±‚è·å–å†…éƒ¨æ•°æ®ï¼Œç›´åˆ°å‰©ä¸‹æœ€åä¸€å±‚ä¸‹æ ‡ï¼Œèµ‹å€¼ï¼Œç„¶åè¿”å›ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 Find a json in the complex data structures by using array of Int and/or String as path.

 Example:
 
 let json = JSON[data]
 let path = [9,"list","person","name"]
 let name = json[path]


 The same as: let name = json[9]["list"]["person"]["name"]

 - parameter path: The target json's path.

 - returns: Return a json found by the path or a null json with error
 */</span>
<span class="kd">public</span> <span class="nf">subscript</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">JSONSubscriptType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span> <span class="nv">$1</span><span class="p">]</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">path</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">self</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">.</span><span class="n">object</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">var</span> <span class="nv">aPath</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">aPath</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">var</span> <span class="nv">nextJSON</span> <span class="o">=</span> <span class="k">self</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">nextJSON</span><span class="p">[</span><span class="n">aPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
            <span class="k">self</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nextJSON</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 Find a json in the complex data structures by using array of Int and/or String as path.

 - parameter path: The target json's path. Example:

 let name = json[9,"list","person","name"]

 The same as: let name = json[9]["list"]["person"]["name"]

 - returns: Return a json found by the path or a null json with error
 */</span>
<span class="kd">public</span> <span class="nf">subscript</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span><span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span>
        <span class="k">self</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<h3 id="raw">Raw</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - Raw</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">RawRepresentable</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">?(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">rawValue</span><span class="p">)</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">unknown</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">rawValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Any</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">rawData</span><span class="p">(</span><span class="n">options</span> <span class="nv">opt</span><span class="p">:</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="o">=</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">isValidJSONObject</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">invalidJSON</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">try</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">withJSONObject</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">opt</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="kd">public</span> <span class="kd">func</span> <span class="nf">rawString</span><span class="p">(</span><span class="n">_</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span> <span class="o">=</span> <span class="o">.</span><span class="n">utf8</span><span class="p">,</span> <span class="n">options</span> <span class="nv">opt</span><span class="p">:</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="o">=</span> <span class="o">.</span><span class="n">prettyPrinted</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">try</span> <span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">jsonSerialization</span><span class="p">:</span> <span class="n">opt</span><span class="p">])</span>
		<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
			<span class="nf">print</span><span class="p">(</span><span class="s">"Could not serialize object to JSON because:"</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">public</span> <span class="kd">func</span> <span class="nf">rawString</span><span class="p">(</span><span class="n">_</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="nv">writingOptionsKeys</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
		<span class="k">let</span> <span class="nv">encoding</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">encoding</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span> <span class="p">??</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span>
		<span class="k">let</span> <span class="nv">maxObjectDepth</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">maxObjextDepth</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="p">??</span> <span class="mi">10</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">try</span> <span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="n">maxObjectDepth</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
			<span class="nf">print</span><span class="p">(</span><span class="s">"Could not serialize object to JSON because:"</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">_rawString</span><span class="p">(</span><span class="n">_</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span> <span class="o">=</span> <span class="o">.</span><span class="n">utf8</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="nv">writingOptionsKeys</span><span class="p">:</span> <span class="kt">Any</span><span class="p">],</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">maxObjectDepth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span> <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">invalidJSON</span> <span class="p">}</span>
        <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">castNilToNSNull</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Bool</span> <span class="p">??</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">let</span> <span class="nv">jsonOption</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">jsonSerialization</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="p">??</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span><span class="o">.</span><span class="n">prettyPrinted</span>
					<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">rawData</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="n">jsonOption</span><span class="p">)</span>
					<span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="n">encoding</span><span class="p">)</span>
				<span class="p">}</span>

				<span class="k">guard</span> <span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?]</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">return</span> <span class="kc">nil</span>
				<span class="p">}</span>
				<span class="k">let</span> <span class="nv">body</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">key</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
					<span class="k">guard</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: null"</span>
					<span class="p">}</span>
					<span class="k">guard</span> <span class="k">let</span> <span class="nv">unwrappedValue</span> <span class="o">=</span> <span class="n">value</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: null"</span>
					<span class="p">}</span>

					<span class="k">let</span> <span class="nv">nestedValue</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">unwrappedValue</span><span class="p">)</span>
					<span class="k">guard</span> <span class="k">let</span> <span class="nv">nestedString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedValue</span><span class="o">.</span><span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="n">maxObjectDepth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">elementTooDeep</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="n">nestedValue</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">string</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: </span><span class="se">\"\(</span><span class="n">nestedString</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\\</span><span class="s">"</span><span class="p">)</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\"</span><span class="s">"</span><span class="p">)</span><span class="se">)\"</span><span class="s">"</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: </span><span class="se">\(</span><span class="n">nestedString</span><span class="se">)</span><span class="s">"</span>
					<span class="p">}</span>
				<span class="p">}</span>

				<span class="k">return</span> <span class="s">"{</span><span class="se">\(</span><span class="n">body</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span><span class="se">)</span><span class="s">}"</span>
			<span class="p">}</span> <span class="k">catch</span> <span class="n">_</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kc">nil</span>
			<span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">do</span> <span class="p">{</span>
				<span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">castNilToNSNull</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Bool</span> <span class="p">??</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">let</span> <span class="nv">jsonOption</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">jsonSerialization</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="p">??</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span><span class="o">.</span><span class="n">prettyPrinted</span>
					<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">rawData</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="n">jsonOption</span><span class="p">)</span>
					<span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="n">encoding</span><span class="p">)</span>
				<span class="p">}</span>

                <span class="k">guard</span> <span class="k">let</span> <span class="nv">array</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">Any</span><span class="p">?]</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
                <span class="k">let</span> <span class="nv">body</span> <span class="o">=</span> <span class="k">try</span> <span class="n">array</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">unwrappedValue</span> <span class="o">=</span> <span class="n">value</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="s">"null"</span>
                    <span class="p">}</span>

                    <span class="k">let</span> <span class="nv">nestedValue</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">unwrappedValue</span><span class="p">)</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">nestedString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedValue</span><span class="o">.</span><span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="n">maxObjectDepth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">invalidJSON</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="n">nestedValue</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">string</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">nestedString</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\\</span><span class="s">"</span><span class="p">)</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\"</span><span class="s">"</span><span class="p">)</span><span class="se">)\"</span><span class="s">"</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="n">nestedString</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="s">"[</span><span class="se">\(</span><span class="n">body</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span><span class="se">)</span><span class="s">]"</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="n">_</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span><span class="o">.</span><span class="n">stringValue</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span><span class="o">.</span><span class="n">description</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">null</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"null"</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æœ€åç»“æœ">æœ€åç»“æœ</h3>

<p>è¿™æ ·å¯ä»¥ä½¿ç”¨ç±»ä¼¼<code class="language-plaintext highlighter-rouge">json["items"][0]</code>è¿™æ ·å»è·å–å…ƒç´ ã€‚ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ­¤æ—¶è·å–åˆ°çš„å…ƒç´ æ˜¯<code class="language-plaintext highlighter-rouge">JSON</code>ç»“æ„ä½“ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒè½¬åŒ–æˆswiftç±»å‹çš„å…ƒç´ ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">SwiftyJSON</code>é€šè¿‡å¢åŠ ä¸€ç³»åˆ—å±æ€§ï¼ŒåŒ…å«äº†å…¨éƒ¨å¼€å‘ä¸­å¯èƒ½çš„ç›®æ ‡ç±»å‹ï¼Œè®©ç”¨æˆ·æ–¹ä¾¿çš„è·å–æƒ³è¦ç±»å‹çš„æœ€ç»ˆç»“æœã€‚å¦‚<code class="language-plaintext highlighter-rouge">array arrayValue string stringValue</code>ç­‰ç­‰ï¼Œè¿™é‡Œæ¯ç§ç±»å‹æœ‰ä¸¤ç§ç‰ˆæœ¬ã€‚</p>

<h4 id="ä¸å«value">ä¸å«<code class="language-plaintext highlighter-rouge">Value</code></h4>

<p>å¦‚ <code class="language-plaintext highlighter-rouge">array, string</code></p>

<p>å¦‚æœä¸èƒ½æŠŠæœ€ç»ˆç»“æœè½¬åŒ–ä¸ºå¯¹åº”çš„ç±»å‹ï¼Œå°†è¿”å›<code class="language-plaintext highlighter-rouge">nil</code></p>

<h4 id="å«æœ‰value">å«æœ‰Value</h4>

<p>å¦‚<code class="language-plaintext highlighter-rouge">arrayValue, stringValue</code>ï¼Œå¦‚æœä¸èƒ½æŠŠæœ€ç»ˆç»“æœè½¬åŒ–ä¸ºå¯¹åº”çš„ç±»å‹ï¼Œå°†è¿”å› <code class="language-plaintext highlighter-rouge">[]ç©ºæ•°ç»„</code> ,<code class="language-plaintext highlighter-rouge">""ç©ºå­—ç¬¦ä¸²</code></p>

<h4 id="æœ€å">æœ€å</h4>

<p>å¦‚æœä¸å±æ€§ç›¸ç¬¦åˆ™è¿”å›ç›¸åº”çš„<code class="language-plaintext highlighter-rouge">rowValue</code>ï¼Œå¦‚æœä¸ç›¸ç¬¦åˆ™å°è¯•è½¬æ¢æˆ–ç›´æ¥è¿”å›<code class="language-plaintext highlighter-rouge">nil</code>(å¦‚æœæ˜¯<code class="language-plaintext highlighter-rouge">Value</code>ç‰ˆæœ¬è¿”å›é»˜è®¤å€¼).</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - Array</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional [JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">JSON</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">array</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">JSON</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional [JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">arrayValue</span><span class="p">:</span> <span class="p">[</span><span class="kt">JSON</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">array</span> <span class="p">??</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="c1">//Optional [Any]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">arrayObject</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">array</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">array</span> <span class="k">as</span> <span class="kt">Any</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Dictionary</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional [String : JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">dictionary</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">dictionary</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">d</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">](</span><span class="nv">minimumCapacity</span><span class="p">:</span> <span class="n">rawDictionary</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">in</span> <span class="n">rawDictionary</span> <span class="p">{</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional [String : JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">dictionaryValue</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="p">??</span> <span class="p">[:]</span>
    <span class="p">}</span>

    <span class="c1">//Optional [String : Any]</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">dictionaryObject</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">v</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">v</span> <span class="k">as</span> <span class="kt">Any</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Bool</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span> <span class="c1">// : Swift.Bool</span>

    <span class="c1">//Optional bool</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">bool</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span> <span class="k">as</span> <span class="kt">Bool</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional bool</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">boolValue</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span><span class="o">.</span><span class="n">boolValue</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="s">"true"</span><span class="p">,</span> <span class="s">"y"</span><span class="p">,</span> <span class="s">"t"</span><span class="p">,</span> <span class="s">"yes"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="o">.</span><span class="nf">caseInsensitiveCompare</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span> <span class="p">}</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - String</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional string</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">String</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional string</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">stringValue</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">??</span> <span class="s">""</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span><span class="o">.</span><span class="n">stringValue</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="nf">return</span> <span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">Bool</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="s">""</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">""</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Number</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional number</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">number</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">??</span> <span class="kt">NSNull</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional number</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">numberValue</span><span class="p">:</span> <span class="kt">NSNumber</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">decimal</span> <span class="o">=</span> <span class="kt">NSDecimalNumber</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">decimal</span> <span class="o">==</span> <span class="kt">NSDecimalNumber</span><span class="o">.</span><span class="n">notANumber</span> <span class="p">{</span>  <span class="c1">// indicates parse error</span>
                    <span class="k">return</span> <span class="kt">NSDecimalNumber</span><span class="o">.</span><span class="n">zero</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">decimal</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">NSNumber</span> <span class="p">??</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Null</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">null</span><span class="p">:</span> <span class="kt">NSNull</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">null</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNull</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">exists</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">errorValue</span> <span class="o">=</span> <span class="n">error</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="o">...</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">errorValue</span><span class="o">.</span><span class="n">errorCode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - URL</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional URL</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="c1">// Check for existing percent escapes first to prevent double-escaping of % character</span>
                <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"%[0-9A-Fa-f]{2}"</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">regularExpression</span><span class="p">,</span> <span class="nv">range</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">locale</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kt">Foundation</span><span class="o">.</span><span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">encodedString_</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="o">.</span><span class="nf">addingPercentEncoding</span><span class="p">(</span><span class="nv">withAllowedCharacters</span><span class="p">:</span> <span class="kt">CharacterSet</span><span class="o">.</span><span class="n">urlQueryAllowed</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// We have to use `Foundation.URL` otherwise it conflicts with the variable name.</span>
                    <span class="k">return</span> <span class="kt">Foundation</span><span class="o">.</span><span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">encodedString_</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">?</span><span class="o">.</span><span class="n">absoluteString</span> <span class="p">??</span> <span class="kt">NSNull</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Int, Double, Float, Int8, Int16, Int32, Int64</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">double</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">doubleValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">doubleValue</span><span class="p">:</span> <span class="kt">Double</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">doubleValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">float</span><span class="p">:</span> <span class="kt">Float</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">floatValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">floatValue</span><span class="p">:</span> <span class="kt">Float</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">floatValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">intValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">intValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">intValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt</span><span class="p">:</span> <span class="kt">UInt</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uintValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uIntValue</span><span class="p">:</span> <span class="kt">UInt</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uintValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int8</span><span class="p">:</span> <span class="kt">Int8</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">(</span><span class="n">newValue</span><span class="p">))</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int8Value</span><span class="p">:</span> <span class="kt">Int8</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">(</span><span class="n">newValue</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt8</span><span class="p">:</span> <span class="kt">UInt8</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt8Value</span><span class="p">:</span> <span class="kt">UInt8</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int16</span><span class="p">:</span> <span class="kt">Int16</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int16Value</span><span class="p">:</span> <span class="kt">Int16</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt16</span><span class="p">:</span> <span class="kt">UInt16</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt16Value</span><span class="p">:</span> <span class="kt">UInt16</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int32</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int32Value</span><span class="p">:</span> <span class="kt">Int32</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt32</span><span class="p">:</span> <span class="kt">UInt32</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt32Value</span><span class="p">:</span> <span class="kt">UInt32</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int64</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int64Value</span><span class="p">:</span> <span class="kt">Int64</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt64</span><span class="p">:</span> <span class="kt">UInt64</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt64Value</span><span class="p">:</span> <span class="kt">UInt64</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="é‡è½½æ“ä½œç¬¦">é‡è½½æ“ä½œç¬¦</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - Comparable</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Comparable</span> <span class="p">{}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="o">.</span><span class="n">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawBool</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">.</span><span class="n">dictionary</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&lt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&lt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="o">.</span><span class="n">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawBool</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">.</span><span class="n">dictionary</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&gt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&gt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="o">.</span><span class="n">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawBool</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">.</span><span class="n">dictionary</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&gt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&gt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="k">let</span> <span class="nv">trueNumber</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="kd">private</span> <span class="k">let</span> <span class="nv">falseNumber</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span> <span class="k">let</span> <span class="nv">trueObjCType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="n">trueNumber</span><span class="o">.</span><span class="n">objCType</span><span class="p">)</span>
<span class="kd">private</span> <span class="k">let</span> <span class="nv">falseObjCType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="n">falseNumber</span><span class="o">.</span><span class="n">objCType</span><span class="p">)</span>

<span class="c1">// MARK: - NSNumber: Comparable</span>

<span class="kd">extension</span> <span class="kt">NSNumber</span> <span class="p">{</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">isBool</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">objCType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">objCType</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">trueNumber</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span> <span class="o">&amp;&amp;</span> <span class="n">objCType</span> <span class="o">==</span> <span class="n">trueObjCType</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">falseNumber</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span> <span class="o">&amp;&amp;</span> <span class="n">objCType</span> <span class="o">==</span> <span class="n">falseObjCType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">!=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">lhs</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedAscending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="kt">ComparisonResult</span><span class="o">.</span><span class="n">orderedDescending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">!=</span> <span class="o">.</span><span class="n">orderedDescending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">!=</span> <span class="o">.</span><span class="n">orderedAscending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">writingOptionsKeys</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">jsonSerialization</span>
	<span class="k">case</span> <span class="n">castNilToNSNull</span>
	<span class="k">case</span> <span class="n">maxObjextDepth</span>
	<span class="k">case</span> <span class="n">encoding</span>
<span class="p">}</span>

</code></pre></div></div>

<h1 id="æºç ">æºç </h1>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//  SwiftyJSON.swift</span>
<span class="c1">//</span>
<span class="c1">//  Copyright (c) 2014 - 2017 Ruoyu Fu, Pinglin Tang</span>
<span class="c1">//</span>
<span class="c1">//  Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c1">//  of this software and associated documentation files (the "Software"), to deal</span>
<span class="c1">//  in the Software without restriction, including without limitation the rights</span>
<span class="c1">//  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c1">//  copies of the Software, and to permit persons to whom the Software is</span>
<span class="c1">//  furnished to do so, subject to the following conditions:</span>
<span class="c1">//</span>
<span class="c1">//  The above copyright notice and this permission notice shall be included in</span>
<span class="c1">//  all copies or substantial portions of the Software.</span>
<span class="c1">//</span>
<span class="c1">//  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c1">//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1">//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c1">//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c1">//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c1">//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c1">//  THE SOFTWARE.</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="c1">// MARK: - Error</span>
<span class="c1">// swiftlint:disable line_length</span>
<span class="c1">/// Error domain</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorDomain is deprecated. Use `SwiftyJSONError.errorDomain` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.errorDomain"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorDomain</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"SwiftyJSONErrorDomain"</span>

<span class="c1">/// Error code</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorUnsupportedType is deprecated. Use `SwiftyJSONError.unsupportedType` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.unsupportedType"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorUnsupportedType</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">999</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorIndexOutOfBounds is deprecated. Use `SwiftyJSONError.indexOutOfBounds` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.indexOutOfBounds"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorIndexOutOfBounds</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">900</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorWrongType is deprecated. Use `SwiftyJSONError.wrongType` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.wrongType"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorWrongType</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">901</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorNotExist is deprecated. Use `SwiftyJSONError.notExist` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.notExist"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorNotExist</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">500</span>
<span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"ErrorInvalidJSON is deprecated. Use `SwiftyJSONError.invalidJSON` instead."</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span> <span class="s">"SwiftyJSONError.invalidJSON"</span><span class="p">)</span>
<span class="kd">public</span> <span class="k">let</span> <span class="nv">ErrorInvalidJSON</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">490</span>

<span class="c1">// SwiftyJSON é”™è¯¯</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">SwiftyJSONError</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">unsupportedType</span> <span class="o">=</span> <span class="mi">999</span>
    <span class="k">case</span> <span class="n">indexOutOfBounds</span> <span class="o">=</span> <span class="mi">900</span>
    <span class="k">case</span> <span class="n">elementTooDeep</span> <span class="o">=</span> <span class="mi">902</span>
    <span class="k">case</span> <span class="n">wrongType</span> <span class="o">=</span> <span class="mi">901</span>
    <span class="k">case</span> <span class="n">notExist</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="k">case</span> <span class="n">invalidJSON</span> <span class="o">=</span> <span class="mi">490</span>
<span class="p">}</span>

<span class="c1">// SwiftyJSON é”™è¯¯ extension</span>
<span class="kd">extension</span> <span class="kt">SwiftyJSONError</span><span class="p">:</span> <span class="kt">CustomNSError</span> <span class="p">{</span>

    <span class="c1">/// return the error domain of SwiftyJSONError</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">errorDomain</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"com.swiftyjson.SwiftyJSON"</span> <span class="p">}</span>

    <span class="c1">/// return the error code of SwiftyJSONError</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">errorCode</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawValue</span> <span class="p">}</span>

    <span class="c1">/// return the userInfo of SwiftyJSONError</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">errorUserInfo</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">unsupportedType</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"It is an unsupported type."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">indexOutOfBounds</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Array Index is out of bounds."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">wrongType</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Couldn't merge, because the JSONs differ in type on top level."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Dictionary key does not exist."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">invalidJSON</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"JSON is invalid."</span><span class="p">]</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">elementTooDeep</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">:</span> <span class="s">"Element too deep. Increase maxObjectDepth and make sure there is no reference loop."</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - JSON Type</span>

<span class="cm">/**
JSON's type definitions.

See http://www.json.org
*/</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="k">Type</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">number</span>
	<span class="k">case</span> <span class="n">string</span>
	<span class="k">case</span> <span class="n">bool</span>
	<span class="k">case</span> <span class="n">array</span>
	<span class="k">case</span> <span class="n">dictionary</span>
	<span class="k">case</span> <span class="n">null</span>
	<span class="k">case</span> <span class="n">unknown</span>
<span class="p">}</span>

<span class="c1">// MARK: - JSON Base</span>

<span class="c1">// JSON ç»“æ„ä½“</span>
<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">JSON</span> <span class="p">{</span>

	<span class="cm">/**
	 Creates a JSON using the data.
	
	 - parameter data: The NSData used to convert to json.Top level object in data is an NSArray or NSDictionary
	 - parameter opt: The JSON serialization reading options. `[]` by default.
	
	 - returns: The created JSON
	 */</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">,</span> <span class="n">options</span> <span class="nv">opt</span><span class="p">:</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">ReadingOptions</span> <span class="o">=</span> <span class="p">[])</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span> <span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">opt</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="n">object</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="cm">/**
	 Creates a JSON object
	 - note: this does not parse a `String` into JSON, instead use `init(parseJSON: String)`
	
	 - parameter object: the object

	 - returns: the created JSON object
	 */</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">object</span> <span class="p">{</span>
        <span class="k">case</span> <span class="k">let</span> <span class="nv">object</span> <span class="k">as</span> <span class="kt">Data</span><span class="p">:</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">object</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="kt">NSNull</span><span class="p">())</span>
            <span class="p">}</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="n">object</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

	<span class="cm">/**
	 Parses the JSON string into a JSON object
	
	 - parameter json: the JSON string
	
	 - returns: the created JSON object
	*/</span>
	<span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">parseJSON</span> <span class="nv">jsonString</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="kt">NSNull</span><span class="p">())</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/**
	 Creates a JSON from JSON string
	
	 - parameter json: Normal json string like '{"a":"b"}'
	
	 - returns: The created JSON
	 */</span>
    <span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"Use instead `init(parseJSON: )`"</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">parse</span><span class="p">(</span><span class="n">_</span> <span class="nv">json</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
            <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSON</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="kt">JSON</span><span class="p">(</span><span class="kt">NSNull</span><span class="p">())</span>
    <span class="p">}</span>

	<span class="cm">/**
	 Creates a JSON using the object.
	
	 - parameter jsonObject:  The object must have the following properties: All objects are NSString/String, NSNumber/Int/Float/Double/Bool, NSArray/Array, NSDictionary/Dictionary, or NSNull; All dictionary keys are NSStrings/String; NSNumbers are not NaN or infinity.
	
	 - returns: The created JSON
	 */</span>
    <span class="kd">fileprivate</span> <span class="nf">init</span><span class="p">(</span><span class="nv">jsonObject</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">jsonObject</span>
    <span class="p">}</span>

	<span class="cm">/**
	 Merges another JSON into this JSON, whereas primitive values which are not present in this JSON are getting added,
	 present values getting overwritten, array values getting appended and nested JSONs getting merged the same way.
 
	 - parameter other: The JSON which gets merged into this JSON
	
	 - throws `ErrorWrongType` if the other JSONs differs in type on the top level.
	 */</span>
    <span class="kd">public</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">merge</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">merge</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">other</span><span class="p">,</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>

	<span class="cm">/**
	 Merges another JSON into this JSON and returns a new JSON, whereas primitive values which are not present in this JSON are getting added,
	 present values getting overwritten, array values getting appended and nested JSONS getting merged the same way.
	
	 - parameter other: The JSON which gets merged into this JSON
	
	 - throws `ErrorWrongType` if the other JSONs differs in type on the top level.
	
	 - returns: New merged JSON
	 */</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">merged</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">merged</span> <span class="o">=</span> <span class="k">self</span>
        <span class="k">try</span> <span class="n">merged</span><span class="o">.</span><span class="nf">merge</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">other</span><span class="p">,</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged</span>
    <span class="p">}</span>

    <span class="cm">/**
     Private woker function which does the actual merging
     Typecheck is set to true for the first recursion level to prevent total override of the source JSON
 	*/</span>
 	<span class="kd">fileprivate</span> <span class="k">mutating</span> <span class="kd">func</span> <span class="nf">merge</span><span class="p">(</span><span class="n">with</span> <span class="nv">other</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">in</span> <span class="n">other</span> <span class="p">{</span>
                    <span class="k">try</span> <span class="k">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="nf">merge</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">other</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nv">typecheck</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
                <span class="k">self</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">arrayValue</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">arrayValue</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">self</span> <span class="o">=</span> <span class="n">other</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">typecheck</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">wrongType</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span> <span class="o">=</span> <span class="n">other</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// Private object</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawArray</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawDictionary</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawString</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawNumber</span><span class="p">:</span> <span class="kt">NSNumber</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawNull</span><span class="p">:</span> <span class="kt">NSNull</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">rawBool</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="c1">/// JSON type, fileprivate setter</span>
    <span class="kd">public</span> <span class="nf">fileprivate</span><span class="p">(</span><span class="k">set</span><span class="p">)</span> <span class="k">var</span> <span class="nv">type</span><span class="p">:</span> <span class="k">Type</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>

    <span class="c1">/// Error in JSON, fileprivate setter</span>
    <span class="kd">public</span> <span class="nf">fileprivate</span><span class="p">(</span><span class="k">set</span><span class="p">)</span> <span class="k">var</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">SwiftyJSONError</span><span class="p">?</span>

    <span class="c1">/// Object in JSON</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNull</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">nil</span>
            <span class="k">switch</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">newValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="k">let</span> <span class="nv">number</span> <span class="k">as</span> <span class="kt">NSNumber</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">isBool</span> <span class="p">{</span>
                    <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">bool</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">=</span> <span class="n">number</span><span class="o">.</span><span class="n">boolValue</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">number</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">=</span> <span class="n">number</span>
                <span class="p">}</span>
            <span class="k">case</span> <span class="k">let</span> <span class="nv">string</span> <span class="k">as</span> <span class="kt">String</span><span class="p">:</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">string</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawString</span> <span class="o">=</span> <span class="n">string</span>
            <span class="k">case</span> <span class="n">_</span> <span class="k">as</span> <span class="kt">NSNull</span><span class="p">:</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>
            <span class="k">case</span> <span class="nv">nil</span><span class="p">:</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">null</span>
            <span class="k">case</span> <span class="k">let</span> <span class="nv">array</span> <span class="k">as</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]:</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">array</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span> <span class="o">=</span> <span class="n">array</span>
            <span class="k">case</span> <span class="k">let</span> <span class="nv">dictionary</span> <span class="k">as</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]:</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">dictionary</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="o">=</span> <span class="n">dictionary</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="n">type</span> <span class="o">=</span> <span class="o">.</span><span class="n">unknown</span>
                <span class="n">error</span> <span class="o">=</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">unsupportedType</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// The static null JSON</span>
    <span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">unavailable</span><span class="p">,</span> <span class="nv">renamed</span><span class="p">:</span><span class="s">"null"</span><span class="p">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">nullJSON</span><span class="p">:</span> <span class="kt">JSON</span> <span class="p">{</span> <span class="k">return</span> <span class="n">null</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">null</span><span class="p">:</span> <span class="kt">JSON</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">JSON</span><span class="p">(</span><span class="kt">NSNull</span><span class="p">())</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">/// Private method to unwarp an object recursively</span>
<span class="kd">private</span> <span class="kd">func</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">_</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Any</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">object</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">json</span> <span class="k">as</span> <span class="kt">JSON</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">array</span> <span class="k">as</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="n">unwrap</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">dictionary</span> <span class="k">as</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]:</span>
        <span class="k">var</span> <span class="nv">unwrappedDic</span> <span class="o">=</span> <span class="n">dictionary</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">in</span> <span class="n">dictionary</span> <span class="p">{</span>
            <span class="n">unwrappedDic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nf">unwrap</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">unwrappedDic</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">object</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">Index</span><span class="o">&lt;</span><span class="kt">T</span><span class="p">:</span> <span class="kt">Any</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Comparable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">array</span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">dictionary</span><span class="p">(</span><span class="kt">DictionaryIndex</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">null</span>

    <span class="kd">static</span> <span class="kd">public</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span> <span class="k">return</span> <span class="kc">true</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">static</span> <span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>
        <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">left</span><span class="p">),</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">right</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">JSONIndex</span> <span class="o">=</span> <span class="kt">Index</span><span class="o">&lt;</span><span class="kt">JSON</span><span class="o">&gt;</span>
<span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">JSONRawIndex</span> <span class="o">=</span> <span class="kt">Index</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Collection</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">typealias</span> <span class="kt">Index</span> <span class="o">=</span> <span class="kt">JSONRawIndex</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">startIndex</span><span class="p">:</span> <span class="kt">Index</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rawArray</span><span class="o">.</span><span class="n">startIndex</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="n">rawDictionary</span><span class="o">.</span><span class="n">startIndex</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">endIndex</span><span class="p">:</span> <span class="kt">Index</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rawArray</span><span class="o">.</span><span class="n">endIndex</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="n">rawDictionary</span><span class="o">.</span><span class="n">endIndex</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">index</span><span class="p">(</span><span class="n">after</span> <span class="nv">i</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Index</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">i</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="n">rawArray</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">after</span><span class="p">:</span> <span class="n">idx</span><span class="p">))</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="n">rawDictionary</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="nv">after</span><span class="p">:</span> <span class="n">idx</span><span class="p">))</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">subscript</span> <span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="kt">Index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">JSON</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">position</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">array</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="nf">return</span> <span class="p">(</span><span class="kt">String</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="kt">JSON</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">dictionary</span><span class="p">(</span><span class="k">let</span> <span class="nv">idx</span><span class="p">):</span>
            <span class="k">let</span> <span class="p">(</span><span class="nv">key</span><span class="p">,</span> <span class="nv">value</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nf">return</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nf">return</span> <span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="kt">JSON</span><span class="o">.</span><span class="n">null</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Subscript</span>

<span class="cm">/**
 *  To mark both String and Int can be used in subscript.
 */</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">JSONKey</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">index</span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">key</span><span class="p">(</span><span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">JSONSubscriptType</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">jsonKey</span><span class="p">:</span> <span class="kt">JSONKey</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Int</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">jsonKey</span><span class="p">:</span> <span class="kt">JSONKey</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">JSONKey</span><span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">String</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">jsonKey</span><span class="p">:</span> <span class="kt">JSONKey</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">JSONKey</span><span class="o">.</span><span class="nf">key</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">/// If `type` is `.array`, return json whose object is `array[index]`, otherwise return null json with error.</span>
    <span class="kd">fileprivate</span> <span class="nf">subscript</span><span class="p">(</span><span class="n">index</span> <span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="o">.</span><span class="n">array</span> <span class="p">{</span>
                <span class="k">var</span> <span class="nv">r</span> <span class="o">=</span> <span class="kt">JSON</span><span class="o">.</span><span class="n">null</span>
                <span class="n">r</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">error</span> <span class="p">??</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">wrongType</span>
                <span class="k">return</span> <span class="n">r</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kt">JSON</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">var</span> <span class="nv">r</span> <span class="o">=</span> <span class="kt">JSON</span><span class="o">.</span><span class="n">null</span>
                <span class="n">r</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">indexOutOfBounds</span>
                <span class="k">return</span> <span class="n">r</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">array</span> <span class="o">&amp;&amp;</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="n">newValue</span><span class="o">.</span><span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">.</span><span class="n">object</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// If `type` is `.dictionary`, return json whose object is `dictionary[key]` , otherwise return null json with error.</span>
    <span class="kd">fileprivate</span> <span class="nf">subscript</span><span class="p">(</span><span class="n">key</span> <span class="nv">key</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">r</span> <span class="o">=</span> <span class="kt">JSON</span><span class="o">.</span><span class="n">null</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">dictionary</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">o</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">{</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">notExist</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">r</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">error</span> <span class="p">??</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">wrongType</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">r</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">dictionary</span> <span class="o">&amp;&amp;</span> <span class="n">newValue</span><span class="o">.</span><span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">.</span><span class="n">object</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// If `sub` is `Int`, return `subscript(index:)`; If `sub` is `String`,  return `subscript(key:)`.</span>
    <span class="kd">fileprivate</span> <span class="nf">subscript</span><span class="p">(</span><span class="n">sub</span> <span class="nv">sub</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">sub</span><span class="o">.</span><span class="n">jsonKey</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="k">let</span> <span class="nv">index</span><span class="p">):</span> <span class="k">return</span> <span class="k">self</span><span class="p">[</span><span class="nv">index</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">key</span><span class="p">(</span><span class="k">let</span> <span class="nv">key</span><span class="p">):</span> <span class="k">return</span> <span class="k">self</span><span class="p">[</span><span class="nv">key</span><span class="p">:</span> <span class="n">key</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">sub</span><span class="o">.</span><span class="n">jsonKey</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">index</span><span class="p">(</span><span class="k">let</span> <span class="nv">index</span><span class="p">):</span> <span class="k">self</span><span class="p">[</span><span class="nv">index</span><span class="p">:</span> <span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">key</span><span class="p">(</span><span class="k">let</span> <span class="nv">key</span><span class="p">):</span> <span class="k">self</span><span class="p">[</span><span class="nv">key</span><span class="p">:</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

	<span class="cm">/**
	 Find a json in the complex data structures by using array of Int and/or String as path.
	
	 Example:
	

	 let json = JSON[data]
	 let path = [9,"list","person","name"]
	 let name = json[path]

	
	 The same as: let name = json[9]["list"]["person"]["name"]
	
	 - parameter path: The target json's path.
	
	 - returns: Return a json found by the path or a null json with error
	 */</span>
    <span class="kd">public</span> <span class="nf">subscript</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="p">[</span><span class="kt">JSONSubscriptType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span> <span class="nv">$1</span><span class="p">]</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">path</span><span class="o">.</span><span class="n">count</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">self</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">.</span><span class="n">object</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">var</span> <span class="nv">aPath</span> <span class="o">=</span> <span class="n">path</span>
                <span class="n">aPath</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">var</span> <span class="nv">nextJSON</span> <span class="o">=</span> <span class="k">self</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">nextJSON</span><span class="p">[</span><span class="n">aPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
                <span class="k">self</span><span class="p">[</span><span class="nv">sub</span><span class="p">:</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nextJSON</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
     Find a json in the complex data structures by using array of Int and/or String as path.

     - parameter path: The target json's path. Example:

     let name = json[9,"list","person","name"]

     The same as: let name = json[9]["list"]["person"]["name"]

     - returns: Return a json found by the path or a null json with error
     */</span>
    <span class="kd">public</span> <span class="nf">subscript</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="kt">JSONSubscriptType</span><span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">JSON</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - LiteralConvertible</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByStringLiteral</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">stringLiteral</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">StringLiteralType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">extendedGraphemeClusterLiteral</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">StringLiteralType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">unicodeScalarLiteral</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">StringLiteralType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByIntegerLiteral</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">integerLiteral</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">IntegerLiteralType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByBooleanLiteral</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">booleanLiteral</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">BooleanLiteralType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByFloatLiteral</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">floatLiteral</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">FloatLiteralType</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">value</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByDictionaryLiteral</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">dictionaryLiteral</span> <span class="nv">elements</span><span class="p">:</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Any</span><span class="p">)</span><span class="o">...</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">dictionary</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">](</span><span class="nv">minimumCapacity</span><span class="p">:</span> <span class="n">elements</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">in</span> <span class="n">elements</span> <span class="p">{</span>
            <span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="p">}</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">dictionary</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByArrayLiteral</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="n">arrayLiteral</span> <span class="nv">elements</span><span class="p">:</span> <span class="kt">Any</span><span class="o">...</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">elements</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">ExpressibleByNilLiteral</span> <span class="p">{</span>

    <span class="kd">@available</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"use JSON.null instead. Will be removed in future versions"</span><span class="p">)</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">nilLiteral</span><span class="p">:</span> <span class="p">())</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="kt">NSNull</span><span class="p">()</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Raw</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">RawRepresentable</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">init</span><span class="p">?(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">rawValue</span><span class="p">)</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">unknown</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="n">rawValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Any</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">rawData</span><span class="p">(</span><span class="n">options</span> <span class="nv">opt</span><span class="p">:</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="o">=</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">0</span><span class="p">))</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">isValidJSONObject</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">invalidJSON</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">try</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">withJSONObject</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">opt</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="kd">public</span> <span class="kd">func</span> <span class="nf">rawString</span><span class="p">(</span><span class="n">_</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span> <span class="o">=</span> <span class="o">.</span><span class="n">utf8</span><span class="p">,</span> <span class="n">options</span> <span class="nv">opt</span><span class="p">:</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="o">=</span> <span class="o">.</span><span class="n">prettyPrinted</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">try</span> <span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="nv">jsonSerialization</span><span class="p">:</span> <span class="n">opt</span><span class="p">])</span>
		<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
			<span class="nf">print</span><span class="p">(</span><span class="s">"Could not serialize object to JSON because:"</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">public</span> <span class="kd">func</span> <span class="nf">rawString</span><span class="p">(</span><span class="n">_</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="nv">writingOptionsKeys</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
		<span class="k">let</span> <span class="nv">encoding</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">encoding</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span> <span class="p">??</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span><span class="o">.</span><span class="n">utf8</span>
		<span class="k">let</span> <span class="nv">maxObjectDepth</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">maxObjextDepth</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="p">??</span> <span class="mi">10</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="k">return</span> <span class="k">try</span> <span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="n">maxObjectDepth</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
			<span class="nf">print</span><span class="p">(</span><span class="s">"Could not serialize object to JSON because:"</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">_rawString</span><span class="p">(</span><span class="n">_</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="kt">Encoding</span> <span class="o">=</span> <span class="o">.</span><span class="n">utf8</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="nv">writingOptionsKeys</span><span class="p">:</span> <span class="kt">Any</span><span class="p">],</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">maxObjectDepth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span> <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">invalidJSON</span> <span class="p">}</span>
        <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">castNilToNSNull</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Bool</span> <span class="p">??</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">let</span> <span class="nv">jsonOption</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">jsonSerialization</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="p">??</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span><span class="o">.</span><span class="n">prettyPrinted</span>
					<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">rawData</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="n">jsonOption</span><span class="p">)</span>
					<span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="n">encoding</span><span class="p">)</span>
				<span class="p">}</span>

				<span class="k">guard</span> <span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?]</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">return</span> <span class="kc">nil</span>
				<span class="p">}</span>
				<span class="k">let</span> <span class="nv">body</span> <span class="o">=</span> <span class="k">try</span> <span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">key</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
					<span class="k">guard</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: null"</span>
					<span class="p">}</span>
					<span class="k">guard</span> <span class="k">let</span> <span class="nv">unwrappedValue</span> <span class="o">=</span> <span class="n">value</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: null"</span>
					<span class="p">}</span>

					<span class="k">let</span> <span class="nv">nestedValue</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">unwrappedValue</span><span class="p">)</span>
					<span class="k">guard</span> <span class="k">let</span> <span class="nv">nestedString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedValue</span><span class="o">.</span><span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="n">maxObjectDepth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">elementTooDeep</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="n">nestedValue</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">string</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: </span><span class="se">\"\(</span><span class="n">nestedString</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\\</span><span class="s">"</span><span class="p">)</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\"</span><span class="s">"</span><span class="p">)</span><span class="se">)\"</span><span class="s">"</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">key</span><span class="se">)\"</span><span class="s">: </span><span class="se">\(</span><span class="n">nestedString</span><span class="se">)</span><span class="s">"</span>
					<span class="p">}</span>
				<span class="p">}</span>

				<span class="k">return</span> <span class="s">"{</span><span class="se">\(</span><span class="n">body</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span><span class="se">)</span><span class="s">}"</span>
			<span class="p">}</span> <span class="k">catch</span> <span class="n">_</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kc">nil</span>
			<span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
            <span class="k">do</span> <span class="p">{</span>
				<span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">castNilToNSNull</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Bool</span> <span class="p">??</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">let</span> <span class="nv">jsonOption</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="o">.</span><span class="n">jsonSerialization</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span> <span class="p">??</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="kt">WritingOptions</span><span class="o">.</span><span class="n">prettyPrinted</span>
					<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="nf">rawData</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="n">jsonOption</span><span class="p">)</span>
					<span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="n">encoding</span><span class="p">)</span>
				<span class="p">}</span>

                <span class="k">guard</span> <span class="k">let</span> <span class="nv">array</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">Any</span><span class="p">?]</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
                <span class="k">let</span> <span class="nv">body</span> <span class="o">=</span> <span class="k">try</span> <span class="n">array</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">unwrappedValue</span> <span class="o">=</span> <span class="n">value</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="s">"null"</span>
                    <span class="p">}</span>

                    <span class="k">let</span> <span class="nv">nestedValue</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">unwrappedValue</span><span class="p">)</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">nestedString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">nestedValue</span><span class="o">.</span><span class="nf">_rawString</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="nv">maxObjectDepth</span><span class="p">:</span> <span class="n">maxObjectDepth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">throw</span> <span class="kt">SwiftyJSONError</span><span class="o">.</span><span class="n">invalidJSON</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="n">nestedValue</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">string</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="s">"</span><span class="se">\"\(</span><span class="n">nestedString</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\\</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\\</span><span class="s">"</span><span class="p">)</span><span class="o">.</span><span class="nf">replacingOccurrences</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="s">"</span><span class="se">\\\"</span><span class="s">"</span><span class="p">)</span><span class="se">)\"</span><span class="s">"</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="n">nestedString</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="s">"[</span><span class="se">\(</span><span class="n">body</span><span class="o">.</span><span class="nf">joined</span><span class="p">(</span><span class="nv">separator</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span><span class="se">)</span><span class="s">]"</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="n">_</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span><span class="o">.</span><span class="n">stringValue</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span><span class="o">.</span><span class="n">description</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">null</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"null"</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Printable, DebugPrintable</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">CustomStringConvertible</span><span class="p">,</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">CustomDebugStringConvertible</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">description</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">rawString</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">prettyPrinted</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">string</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">"unknown"</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">debugDescription</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">description</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Array</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional [JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">JSON</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">array</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">JSON</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional [JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">arrayValue</span><span class="p">:</span> <span class="p">[</span><span class="kt">JSON</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">array</span> <span class="p">??</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="c1">//Optional [Any]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">arrayObject</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">array</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawArray</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">array</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">array</span> <span class="k">as</span> <span class="kt">Any</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Dictionary</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional [String : JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">dictionary</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="o">.</span><span class="n">dictionary</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">d</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">](</span><span class="nv">minimumCapacity</span><span class="p">:</span> <span class="n">rawDictionary</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">in</span> <span class="n">rawDictionary</span> <span class="p">{</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kt">JSON</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional [String : JSON]</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">dictionaryValue</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="p">??</span> <span class="p">[:]</span>
    <span class="p">}</span>

    <span class="c1">//Optional [String : Any]</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">dictionaryObject</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">dictionary</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawDictionary</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">v</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">v</span> <span class="k">as</span> <span class="kt">Any</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Bool</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span> <span class="c1">// : Swift.Bool</span>

    <span class="c1">//Optional bool</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">bool</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span> <span class="k">as</span> <span class="kt">Bool</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional bool</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">boolValue</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span><span class="o">.</span><span class="n">boolValue</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="s">"true"</span><span class="p">,</span> <span class="s">"y"</span><span class="p">,</span> <span class="s">"t"</span><span class="p">,</span> <span class="s">"yes"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span> <span class="p">{</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="o">.</span><span class="nf">caseInsensitiveCompare</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span> <span class="p">}</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - String</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional string</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">string</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">String</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional string</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">stringValue</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">String</span> <span class="p">??</span> <span class="s">""</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span><span class="o">.</span><span class="n">stringValue</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="nf">return</span> <span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">Bool</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">String</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="s">""</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">""</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Number</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional number</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">number</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNumber</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">??</span> <span class="kt">NSNull</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">//Non-optional number</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">numberValue</span><span class="p">:</span> <span class="kt">NSNumber</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="k">let</span> <span class="nv">decimal</span> <span class="o">=</span> <span class="kt">NSDecimalNumber</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">decimal</span> <span class="o">==</span> <span class="kt">NSDecimalNumber</span><span class="o">.</span><span class="n">notANumber</span> <span class="p">{</span>  <span class="c1">// indicates parse error</span>
                    <span class="k">return</span> <span class="kt">NSDecimalNumber</span><span class="o">.</span><span class="n">zero</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">decimal</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">number</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="k">as?</span> <span class="kt">NSNumber</span> <span class="p">??</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">bool</span><span class="p">:</span>
                <span class="k">return</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rawBool</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Null</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">null</span><span class="p">:</span> <span class="kt">NSNull</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">null</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">rawNull</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">exists</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">errorValue</span> <span class="o">=</span> <span class="n">error</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="o">...</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">errorValue</span><span class="o">.</span><span class="n">errorCode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - URL</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="c1">//Optional URL</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="k">self</span><span class="o">.</span><span class="n">type</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">string</span><span class="p">:</span>
                <span class="c1">// Check for existing percent escapes first to prevent double-escaping of % character</span>
                <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="o">.</span><span class="nf">range</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"%[0-9A-Fa-f]{2}"</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">regularExpression</span><span class="p">,</span> <span class="nv">range</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">locale</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kt">Foundation</span><span class="o">.</span><span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">encodedString_</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rawString</span><span class="o">.</span><span class="nf">addingPercentEncoding</span><span class="p">(</span><span class="nv">withAllowedCharacters</span><span class="p">:</span> <span class="kt">CharacterSet</span><span class="o">.</span><span class="n">urlQueryAllowed</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// We have to use `Foundation.URL` otherwise it conflicts with the variable name.</span>
                    <span class="k">return</span> <span class="kt">Foundation</span><span class="o">.</span><span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">encodedString_</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">?</span><span class="o">.</span><span class="n">absoluteString</span> <span class="p">??</span> <span class="kt">NSNull</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Int, Double, Float, Int8, Int16, Int32, Int64</span>

<span class="kd">extension</span> <span class="kt">JSON</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">double</span><span class="p">:</span> <span class="kt">Double</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">doubleValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">doubleValue</span><span class="p">:</span> <span class="kt">Double</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">doubleValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">float</span><span class="p">:</span> <span class="kt">Float</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">floatValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">floatValue</span><span class="p">:</span> <span class="kt">Float</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">floatValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">intValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">intValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">intValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt</span><span class="p">:</span> <span class="kt">UInt</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uintValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uIntValue</span><span class="p">:</span> <span class="kt">UInt</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uintValue</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int8</span><span class="p">:</span> <span class="kt">Int8</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">(</span><span class="n">newValue</span><span class="p">))</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int8Value</span><span class="p">:</span> <span class="kt">Int8</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="p">(</span><span class="n">newValue</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt8</span><span class="p">:</span> <span class="kt">UInt8</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt8Value</span><span class="p">:</span> <span class="kt">UInt8</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint8Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int16</span><span class="p">:</span> <span class="kt">Int16</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int16Value</span><span class="p">:</span> <span class="kt">Int16</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt16</span><span class="p">:</span> <span class="kt">UInt16</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt16Value</span><span class="p">:</span> <span class="kt">UInt16</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint16Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int32</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int32Value</span><span class="p">:</span> <span class="kt">Int32</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt32</span><span class="p">:</span> <span class="kt">UInt32</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt32Value</span><span class="p">:</span> <span class="kt">UInt32</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint32Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int64</span><span class="p">:</span> <span class="kt">Int64</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">int64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">int64Value</span><span class="p">:</span> <span class="kt">Int64</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">int64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt64</span><span class="p">:</span> <span class="kt">UInt64</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">number</span><span class="p">?</span><span class="o">.</span><span class="n">uint64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">newValue</span> <span class="o">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span>  <span class="kt">NSNull</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="k">var</span> <span class="nv">uInt64Value</span><span class="p">:</span> <span class="kt">UInt64</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">numberValue</span><span class="o">.</span><span class="n">uint64Value</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="n">newValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// MARK: - Comparable</span>

<span class="kd">extension</span> <span class="kt">JSON</span><span class="p">:</span> <span class="kt">Swift</span><span class="o">.</span><span class="kt">Comparable</span> <span class="p">{}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="o">.</span><span class="n">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawBool</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">.</span><span class="n">dictionary</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&lt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&lt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="o">.</span><span class="n">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawBool</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">.</span><span class="n">dictionary</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&gt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&gt;=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="o">.</span><span class="n">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawBool</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawBool</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawArray</span> <span class="k">as</span> <span class="kt">NSArray</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">.</span><span class="n">dictionary</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawDictionary</span> <span class="k">as</span> <span class="kt">NSDictionary</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">null</span><span class="p">,</span> <span class="o">.</span><span class="n">null</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&gt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&gt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">JSON</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">.</span><span class="n">number</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawNumber</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawNumber</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="o">.</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="n">rawString</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="o">.</span><span class="n">rawString</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="k">let</span> <span class="nv">trueNumber</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="kd">private</span> <span class="k">let</span> <span class="nv">falseNumber</span> <span class="o">=</span> <span class="kt">NSNumber</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="kd">private</span> <span class="k">let</span> <span class="nv">trueObjCType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="n">trueNumber</span><span class="o">.</span><span class="n">objCType</span><span class="p">)</span>
<span class="kd">private</span> <span class="k">let</span> <span class="nv">falseObjCType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="n">falseNumber</span><span class="o">.</span><span class="n">objCType</span><span class="p">)</span>

<span class="c1">// MARK: - NSNumber: Comparable</span>

<span class="kd">extension</span> <span class="kt">NSNumber</span> <span class="p">{</span>
    <span class="kd">fileprivate</span> <span class="k">var</span> <span class="nv">isBool</span><span class="p">:</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">objCType</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">cString</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">objCType</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">trueNumber</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span> <span class="o">&amp;&amp;</span> <span class="n">objCType</span> <span class="o">==</span> <span class="n">trueObjCType</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">falseNumber</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span> <span class="o">&amp;&amp;</span> <span class="n">objCType</span> <span class="o">==</span> <span class="n">falseObjCType</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedSame</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">!=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">lhs</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="o">.</span><span class="n">orderedAscending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="kt">ComparisonResult</span><span class="o">.</span><span class="n">orderedDescending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">!=</span> <span class="o">.</span><span class="n">orderedDescending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">NSNumber</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">,</span> <span class="n">rhs</span><span class="o">.</span><span class="n">isBool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">case</span> <span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="nf">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">!=</span> <span class="o">.</span><span class="n">orderedAscending</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">writingOptionsKeys</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">jsonSerialization</span>
	<span class="k">case</span> <span class="n">castNilToNSNull</span>
	<span class="k">case</span> <span class="n">maxObjextDepth</span>
	<span class="k">case</span> <span class="n">encoding</span>
<span class="p">}</span>

</code></pre></div></div>

<h1 id="å‚è€ƒ">å‚è€ƒ</h1>

<p><a href="https://www.jianshu.com/p/32d4aba191b7">SwiftyJSONæºä»£ç å­¦ä¹ </a></p>
:ET